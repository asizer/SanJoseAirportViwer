require({cache:{"app/controller":function(){define(["config/config-pros","app/views/LayoutView","app/models/LocationModel","app/controllers/MapController","app/controllers/QueryController","widgets/buildingbutton/BuildingButton","widgets/floorpicker/FloorPicker","widgets/overviewmap/OverviewMap","widgets/loader/LoadIndicator","widgets/basemapgallery/BasemapGallery","widgets/bookmarks/BookmarksController","widgets/newlayersearch/NewLayerSearch","widgets/legend/LegendController","app/views/MapButtonPanelView","app/views/MapCoverView","esri/map","esri/basemaps","esri/geometry/Extent"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r){return{startup:function(){app=this,this.initConfig(),this.initQueryParams(),this.initModels(),this.initLayout();var a=this;this.map.on("load",function(){app.initQueries(),app.initWidgets(),a.layout.publishWindowSize(),a.mapController.publishMapSize()})},initConfig:function(){},initQueryParams:function(){for(var a,b={},c=/\+/g,d=/([^&=]+)=?([^&]*)/g,e=function(a){return decodeURIComponent(a.replace(c," "))},f=window.location.search.substring(1);a=d.exec(f);)b[e(a[1])]=e(a[2]);this.queryParams=b},initModels:function(){var b={building:null,floor:null};this.queryParams.room||(this.queryParams.building?(b.building=this.queryParams.building,b.floor=this.queryParams.floor||null):b=a.defaultLocation),this.locModel=new c(_.extend(b,{id:"locModel"})),this.locModel.startup()},initLayout:function(){this.layout=new b({config:a.layout},"main-container"),this.layout.startup(),this.initMap()},initMap:function(){var b;b=a.dataLayer.mapServiceUrl?a.mapSetup:_.extend(a.mapSetup,{showLabels:!0}),b.extent&&_.isObject(b.extent)&&(b.extent=new r(b.extent)),q.hasOwnProperty(b.basemap)||this.initBasemaps(),this.map=new p("map-container",b),this.mapController=new d({map:this.map,locModel:this.locModel,config:a})},initBasemaps:function(){_.each(a.basemapGallery.customBasemaps,function(a){q.hasOwnProperty(a.title)||(q[a.title]=a)})},initQueries:function(){var b=new e({locModel:this.locModel,dataConfig:a.dataLayer});this.queryParams.room&&b.runRoomFromRoomIDQuery(this.queryParams.room)},initUtils:function(){},initWidgets:function(){this.initBuildingButton(),this.initFloorPicker(),this.initOverviewMap(),this.initLoader();var b=new o({containerDiv:"main-container",id:"map-cover",config:a.layout});b.startup(),this.initBMG(b),this.initLegend(b),this.initBookmarks(b),this.initSearch(b)},initBuildingButton:function(){var a=new f({locModel:this.locModel,containerDiv:"map-container"},null);a.startup()},initFloorPicker:function(){var a=new g({locModel:this.locModel,containerDiv:"map-container"});a.startup(),app.fp=a},initOverviewMap:function(){var b=new h({map:this.map,config:a.overviewMap,mapServiceUrl:a.dataLayer.mapServiceUrl});b.startup()},initLoader:function(){var a=new i({containerDiv:"map-container"});a.startup()},initBMG:function(b){var c=new n({config:a.layout,buttonTitle:"Change Basemap",iconClass:"fa-image",id:"bmgView",toggleDiv:"map-buttons-horizontal",panelDiv:"map-panels-horizontal",mobileView:b});c.startup();var d=new j({map:this.map,config:a.basemapGallery,id:"bmg"},c.replaceDiv);d.startup()},initLegend:function(b){var c=new n({config:a.layout,buttonTitle:"Show Legend",iconClass:"fa-th-list",id:"legendView",toggleDiv:"map-buttons-horizontal",panelDiv:"map-panels-horizontal",mobileView:b});c.startup();var d=new m({map:this.map,dataConfig:a.dataLayer,locModel:this.locModel,id:"legend"},c.replaceDiv);d.startup()},initBookmarks:function(b){var c=new n({config:a.layout,buttonTitle:"Change buildings",iconClass:"fa-location-arrow",id:"bookmarksView",toggleDiv:"map-buttons-horizontal",panelDiv:"map-panels-horizontal",mobileView:b});c.startup();var d=new k({map:this.map,dataConfig:a.dataLayer,locModel:this.locModel,id:"bookmarks"},c.replaceDiv);d.startup(),this.locModel.building||c.mapToggle.click()},initSearch:function(b){var c=new n({config:a.layout,buttonTitle:"Search for Rooms and People",iconClass:"fa-search",id:"searchView",toggleDiv:"map-buttons-horizontal",panelDiv:"map-panels-horizontal",mobileView:b});c.startup();var d=new l({dataConfig:a.dataLayer,id:"layer-search",viewWidget:c},c.replaceDiv);d.startup(),app.globalSearch=d},initInfo:function(b){var c=new n({config:a.layout,buttonTitle:"More Info",iconClass:"fa-info",id:"infoView",toggleDiv:"map-buttons-horizontal",panelDiv:"map-panels-horizontal",mobileView:b});c.startup()}}})},"app/controllers/DynamicLayerController":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/on","esri/layers/ArcGISDynamicMapServiceLayer","app/util/queryUtil","esri/tasks/QueryTask"],function(a,b,c,d,e){return a([],{map:null,locModel:null,dataConfig:null,allLayers:[],nonFilterLayers:[],filterLayers:[],constructor:function(a){this.setClassProperties(a),this.addLayers(),this.attachEventListeners()},setClassProperties:function(a){this.map=a.map,this.locModel=a.locModel,this.dataConfig=a.dataConfig,this.buildingLyrInfo=a.dataConfig.buildingLayerInfo,this.mapServiceUrl=a.dataConfig.mapServiceUrl,this.constructLayerInfo()},attachEventListeners:function(){this.checkForFloorLoad(),this.locModel.on("floor-update",b.hitch(this,this.setDefExprs))},checkForFloorLoad:function(){return this.locModel.floor?(this.setDefExprs({silent:!0}),void(this.mapServiceLayer.loaded?this.setAllLayersVisible():d.once(this.mapServiceLayer,"load",b.hitch(this,this.setAllLayersVisible)))):(this.mapServiceLayer.loaded?this.setNonFilteredLayersVisible():d.once(this.mapServiceLayer,"load",b.hitch(this,this.setNonFilteredLayersVisible)),void d.once(this.locModel,"floor-update",b.hitch(this,this.checkForFloorLoad)))},addLayers:function(){this.mapServiceLayer=new e(this.mapServiceUrl,{id:"dataLayer"}),this.mapServiceLayer.setVisibleLayers([this.buildingLyrInfo.layerNum]),this.map.addLayer(this.mapServiceLayer)},constructLayerInfo:function(){var a=this;_.each(this.dataConfig,function(b){b&&b.layerNum+0===b.layerNum&&b.addToMap&&(a.allLayers.push(b.layerNum),b.floorFilter?a.filterLayers.push({layerNum:b.layerNum,filterFunction:function(a,c){return b.buildingField+" = '"+a+"' AND "+b.floorField+" = '"+c+"'"}}):a.nonFilterLayers.push(b.layerNum))})},setAllLayersVisible:function(){this.mapServiceLayer.setVisibleLayers(this.allLayers)},setNonFilteredLayersVisible:function(){this.mapServiceLayer.setVisibleLayers(this.nonFilterLayers)},setDefExprs:function(a){var b=[],d=this;_.each(this.filterLayers,function(a){b[a.layerNum]=a.filterFunction(d.locModel.building,d.locModel.floor)}),this.mapServiceLayer.setLayerDefinitions(b),c.publish("dynamiclayer-defexpr-update",{layerDefArr:b,silent:a&&a.silent?a.silent:!1})}})})},"app/controllers/FeatureLayerController":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/on","esri/layers/FeatureLayer","app/util/queryUtil","esri/tasks/QueryTask"],function(a,b,c,d,e){return a([],{map:null,locModel:null,dataConfig:null,allLayers:[],filterLayers:[],constructor:function(a){this.setClassProperties(a),this.addLayers(),this.attachEventListeners()},setClassProperties:function(a){this.map=a.map,this.locModel=a.locModel,this.dataConfig=a.dataConfig},attachEventListeners:function(){var a=this;this.locModel.floor?(this.setDefExprs(),this.setAllLayersVisible()):d.once(this.locModel,"floor-update",function(){a.setAllLayersVisible()}),this.locModel.on("floor-update",b.hitch(this,this.setDefExprs))},addLayers:function(){var a=this;_.each(this.dataConfig,function(b,c){if(b&&b.layerNum+0===b.layerNum&&b.url&&b.addToMap){var d=new e(b.url,{id:c.replace("Info","")});d.setVisibility("buildingLayerInfo"===c),a.allLayers.push(d),b.floorFilter&&a.filterLayers.push({layer:d,filterFunction:function(a,c){return b.buildingField+" = '"+a+"' AND "+b.floorField+" = '"+c+"'"}}),a.map.addLayer(d),d.on("load",a.onLayerLoad)}})},onLayerLoad:function(a){a.layer&&a.layer.labelingInfo&&_.each(a.layer.labelingInfo,function(b){var c=b.labelExpression.replace(/[\[\]\s+]+/g,"").split(",");a.layer._outFields=_.union(a.layer._outFields,c)})},setAllLayersVisible:function(){_.each(this.allLayers,function(a){a.show()})},setDefExprs:function(a){var b=this;_.each(this.filterLayers,function(a){a.layer.setDefinitionExpression(a.filterFunction(b.locModel.building,b.locModel.floor))}),c.publish("featurelayer-defexpr-update",{silent:a&&a.silentFlag?a.silentFlag:!1})}})})},"app/controllers/MapController":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/query","dojo/topic","dojo/on","dojo/dom-class","app/controllers/ResultsLayerController","app/controllers/DynamicLayerController","app/controllers/FeatureLayerController"],function(a,b,c,d,e,f,g,h,i){return a([],{map:null,locModel:null,config:null,constructor:function(a){this.setClassProperties(a),this.addLayers(),this.attachEventListeners()},addLayers:function(){this.mapServiceUrl?new h({dataConfig:this.config.dataLayer,locModel:this.locModel,map:this.map}):new i({dataConfig:this.config.dataLayer,locModel:this.locModel,map:this.map}),new g({map:this.map,dataConfig:this.config.dataLayer,symbolConfig:this.config.selectionSymbol,popupWrapper:"popupWrapper"})},setClassProperties:function(a){this.map=a.map,this.locModel=a.locModel,this.config=a.config,this.roomZoom=this.config.dataLayer.roomLayerInfo.zoomTo||21,this.mapServiceUrl=a.config.dataLayer.mapServiceUrl},attachEventListeners:function(){var a=this;this.map.on("click",function(a){d.publish("map-click",a)}),this.map.on("update-start",function(){d.publish("map-update-start")}),this.map.on("update-end",function(){d.publish("map-update-end")}),this.map.on("zoom-end",function(a){d.publish("map-zoom-end",a)}),this.map.on("resize",function(c){a.publishMapSize(c),e.once(a.map,"update-end",b.hitch(a,a.checkLogoSize))}),e.once(this.map,"update-end",b.hitch(a,a.checkLogoSize)),this.locModel.bldgExtent&&this.locModelExtentChangeHandler("bldgExtent"),this.locModel.on("bldgExtent-update",function(b){var c=b.target.bldgExtent;c&&!b.silent&&a.navigateMap(c.expand(1.2))}),d.subscribe("map-changeExtent",b.hitch(this,this.navigateMap)),d.subscribe("map-center",b.hitch(this,this.centerMap))},checkLogoSize:function(){var a=c(".logo-sm",this.map.root);f.toggle(this.map.container,"small-logo",a.length>0)},locModelExtentChangeHandler:function(a,b){var c=b?b.target:this.locModel;c&&c[a]&&this.navigateMap(c[a].expand(1.2))},navigateMap:function(a){this.map.setExtent(a,!0)},centerMap:function(a){this.waitForMapToCenterAndZoom(a)},waitForMapToCenterAndZoom:function(a){this.map.centerAndZoom(a,this.roomZoom).then(b.hitch(this,function(){d.publish("map-center-complete",{centerPoint:a})}))},publishMapSize:function(a){a=a||{};var b=a.height||this.map.height,c=a.width||this.map.width;d.publish("map-resize",{h:b,w:c})}})})},"app/controllers/QueryController":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/on","esri/layers/FeatureLayer","app/util/queryUtil"],function(a,b,c,d,e,f){return a([],{locModel:null,dataConfig:null,currentQueryResults:{},constructor:function(a){this.setClassProperties(a),this.attachEventListeners(),this.locModel.building&&this.runBuildingQuery({building:this.locModel.building,floor:this.locModel.floor})},setClassProperties:function(a){this.locModel=a.locModel,this.buildingLyrInfo=a.dataConfig.buildingLayerInfo,this.floorLyrInfo=a.dataConfig.floorLayerInfo,this.roomLyrInfo=a.dataConfig.roomLayerInfo,this.personQLyrInfo=a.dataConfig.personQueryLayerInfo,this.mapServiceUrl=a.dataConfig.mapServiceUrl,this.roomOutfields=this.computeLayerOutfields(this.roomLyrInfo),this.personOutfields=this.computeLayerOutfields(this.personQLyrInfo),this.roomQLayer=new e(this.roomLyrInfo.url||this.mapServiceUrl+"/"+this.roomLyrInfo.layerNum,{outFields:this.roomOutfields}),this.personQLayer=new e(this.personQLyrInfo.url||this.mapServiceUrl+"/"+this.personQLyrInfo.layerNum,{outFields:this.personOutfields})},attachEventListeners:function(){c.subscribe("map-click",b.hitch(this,this.runMapClickQuery)),c.subscribe("search-select-oid",b.hitch(this,this.runOIDQuery)),this.locModel.on("locModel-findBldgExtent",b.hitch(this,this.runBuildingQuery))},computeLayerOutfields:function(a){return _.chain(a.popupFields).map(function(a){return a.fieldName}).union([a.oidField]).union(a.popupTitleField).value()},runBuildingQuery:function(a){this.clearCurrentQueryResults(),this.currentQueryResults.building=a.building,this.currentQueryResults.floor=a.floor||null,this.currentQueryResults.silentFlag=a.silentFlag||!1,f.createAndRun({query:{outFields:[this.buildingLyrInfo.buildingField],returnGeometry:!0,where:f.constructWhereAnd([{fieldName:this.buildingLyrInfo.buildingField,newValue:this.currentQueryResults.building}])},url:this.buildingLyrInfo.url||this.mapServiceUrl+"/"+this.buildingLyrInfo.layerNum,self:this,callback:this.buildingQueryResponseHandler})},buildingQueryResponseHandler:function(a){return f.checkResponseSuccess(a)&&f.checkFeatureExistence(a)?(!f.checkSingleFeature(a),this.currentQueryResults.bldgExtent=a.features[0].geometry.getExtent(),void this.runFloorQuery()):(this.clearCurrentQueryResults(),void c.publish("query-done"))},runMapClickQuery:function(a){this.clearCurrentQueryResults(),f.createAndRun({query:{outFields:[this.buildingLyrInfo.buildingField],geometry:a.mapPoint,returnGeometry:!0},url:this.buildingLyrInfo.url||this.mapServiceUrl+"/"+this.buildingLyrInfo.layerNum,self:this,callback:this.mapClickResponseHandler,callbackArgs:a.mapPoint})},mapClickResponseHandler:function(a,b){if(!f.checkResponseSuccess(b)||!f.checkFeatureExistence(b)||!f.checkSingleFeature(b))return this.clearCurrentQueryResults(),void c.publish("query-done");var d=b.features[0];this.currentQueryResults.building=d.attributes[this.buildingLyrInfo.buildingField],this.currentQueryResults.bldgExtent=d.geometry.getExtent(),this.currentQueryResults.building===this.locModel.building?this.runRoomQuery(a):this.runFloorQuery()},runFloorQuery:function(){f.createAndRun({query:{outFields:[this.floorLyrInfo.buildingField,this.floorLyrInfo.floorField],where:f.constructWhereAnd([{fieldName:this.floorLyrInfo.buildingField,newValue:this.currentQueryResults.building}]),returnGeometry:!1},url:this.floorLyrInfo.url||this.mapServiceUrl+"/"+this.floorLyrInfo.layerNum,self:this,callback:this.floorQueryResponseHandler})},floorQueryResponseHandler:function(a){if(c.publish("query-done"),!f.checkResponseSuccess(a)||!f.checkFeatureExistence(a))return void this.clearCurrentQueryResults();var b=this.floorLyrInfo.floorField;if(this.currentQueryResults.availFloors=_.map(a.features,function(a){return a.attributes[b]}),!this.currentQueryResults.floor){var d=_.min(this.currentQueryResults.availFloors);d=1/0===d?this.currentQueryResults.availFloors[0]:d,this.currentQueryResults.floor=d}this.currentQueryResults.building===this.locModel.building&&(this.currentQueryResults=_.omit(this.currentQueryResults,"building"),this.currentQueryResults.floor===this.locModel.floor&&(this.currentQueryResults=_.omit(this.currentQueryResults,"floor"))),this.currentQueryResults.silentFlag?this.locModel.silentSet(_.omit(this.currentQueryResults,"silentFlag")):this.locModel.set(_.omit(this.currentQueryResults,"silentFlag"))},runRoomQuery:function(a){f.createAndRun({query:{outFields:this.roomOutfields,geometry:a,returnGeometry:!0,where:f.constructWhereAnd([{fieldName:this.roomLyrInfo.buildingField,newValue:this.locModel.building},{fieldName:this.roomLyrInfo.floorField,newValue:this.locModel.floor}])},url:this.roomLyrInfo.url||this.mapServiceUrl+"/"+this.roomLyrInfo.layerNum,self:this,callback:this.roomQueryResponseHandler,callbackArgs:{centerMap:!1}})},runRoomFromRoomIDQuery:function(a){f.createAndRun({query:{outFields:_.union(this.roomOutfields,[this.roomLyrInfo.buildingField,this.roomLyrInfo.floorField]),returnGeometry:!0,where:f.constructWhereAnd([{fieldName:"UPPER("+this.roomLyrInfo.roomField+")",newValue:a.toUpperCase()}])},url:this.roomLyrInfo.url||this.mapServiceUrl+"/"+this.roomLyrInfo.layerNum,self:this,callback:this.roomQueryResponseHandler,callbackArgs:{centerMap:!0,setCurrentQueryResults:!0}})},roomQueryResponseHandler:function(a,b){if(!f.checkResponseSuccess(b)||!f.checkFeatureExistence(b))return this.clearCurrentQueryResults(),void c.publish("query-done");!f.checkSingleFeature(b);var d=b.features[0];a.setCurrentQueryResults&&(this.currentQueryResults={building:d.attributes[this.roomLyrInfo.buildingField],floor:d.attributes[this.roomLyrInfo.floorField],silentFlag:!0},this.runBuildingQuery(this.currentQueryResults)),d.centerMap=a.centerMap,this.runRoomRelatedQuery(d)},runRoomRelatedQuery:function(a){f.createAndRunRelated({rq:{outFields:this.personOutfields,returnGeometry:!1,relationshipId:this.personQLyrInfo.relationshipId,objectIds:[a.attributes[this.roomLyrInfo.oidField]]},self:this,layerToQuery:this.roomQLayer,callback:this.roomRelatedQueryResponseHandler,callbackArgs:a})},roomRelatedQueryResponseHandler:function(a,b){c.publish("query-done");var d,e,f=a.attributes[this.roomLyrInfo.oidField];(d=b[f])&&(d=d.features)&&(e=d.length>1?this.consolidateAttributes(d):d[0].attributes),c.publish("feature-find",{roomAttr:a.attributes,roomGeom:a.geometry,centerMap:a.centerMap,personAttr:e})},runPersonRelatedQuery:function(a){f.createAndRunRelated({rq:{outFields:_.union(this.roomOutfields,[this.roomLyrInfo.buildingField,this.roomLyrInfo.floorField]),returnGeometry:!0,relationshipId:this.personQLyrInfo.relationshipId,objectIds:[a.attributes[this.personQLyrInfo.oidField]]},self:this,layerToQuery:this.personQLayer,callback:this.personRelatedQueryResponseHandler,callbackArgs:a})},personRelatedQueryResponseHandler:function(a,b){c.publish("query-done");var d,e=a.attributes[this.personQLyrInfo.oidField];if(!(d=b[e])||!(d=d.features))return c.publish("feature-find",{personAttr:a.attributes}),void this.locModel.silentSet({building:null,floor:null,availFloors:[],bldgExtent:null});d.length>1;var f=d[0];f.centerMap=!0,this.currentQueryResults={building:f.attributes[this.roomLyrInfo.buildingField],floor:f.attributes[this.roomLyrInfo.floorField],silentFlag:!0},this.locModel.silentSet(this.currentQueryResults),this.runBuildingQuery(this.currentQueryResults),c.publish("feature-find",{roomAttr:f.attributes,roomGeom:f.geometry,centerMap:!0,personAttr:a.attributes})},runOIDQuery:function(a){switch(a.lyr){case"room":this.runRoomOIDQuery(a.oid);break;case"person":this.runPersonOIDQuery(a.oid)}},runRoomOIDQuery:function(a){f.createAndRun({query:{outFields:_.union(this.roomOutfields,[this.roomLyrInfo.buildingField,this.roomLyrInfo.floorField]),returnGeometry:!0,objectIds:[a]},url:this.roomLyrInfo.url||this.mapServiceUrl+"/"+this.roomLyrInfo.layerNum,self:this,callback:this.roomOIDQueryResponseHandler,callbackArgs:{centerMap:!0}})},roomOIDQueryResponseHandler:function(a,b){if(!f.checkResponseSuccess(b)||!f.checkFeatureExistence(b)||!f.checkSingleFeature(b))return this.clearCurrentQueryResults(),void c.publish("query-done");var d=b.features[0];this.currentQueryResults={building:d.attributes[this.roomLyrInfo.buildingField],floor:d.attributes[this.roomLyrInfo.floorField],silentFlag:!0},this.currentQueryResults.building!==this.locModel.building?this.runBuildingQuery(this.currentQueryResults):this.locModel.silentSet(this.currentQueryResults),d.centerMap=a.centerMap,this.runRoomRelatedQuery(d)},runPersonOIDQuery:function(a){f.createAndRun({query:{outFields:this.personOutfields,objectIds:[a]},url:this.personQLayer.url||this.mapServiceUrl+"/"+this.personQLayer.layerNum,self:this,callback:this.personOIDQueryResponseHandler})},personOIDQueryResponseHandler:function(a){if(!f.checkResponseSuccess(a)||!f.checkFeatureExistence(a)||!f.checkSingleFeature(a))return this.clearCurrentQueryResults(),void c.publish("query-done");var b=a.features[0];this.runPersonRelatedQuery(b)},consolidateAttributes:function(a){var b={};return _.each(a,function(a){_.each(a.attributes,function(a,c){b[c]=b[c]||[],b[c].push(a)})}),_.each(b,function(a,b,c){c[b]=a.join(",<br>")}),b},clearCurrentQueryResults:function(){this.currentQueryResults={}}})})},"app/controllers/ResultsLayerController":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/query","dojo/topic","dojo/on","dojo/dom-construct","dojo/dom-class","dijit/layout/ContentPane","dijit/registry","esri/graphic","esri/layers/GraphicsLayer","esri/dijit/Popup","esri/dijit/PopupMobile","esri/dijit/PopupTemplate","config/layoutConfig","app/util/symbolUtil","dojo/text!app/views/templates/PopupView.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return a([],{map:null,popupInfo:{},dataConfig:null,symbolConfig:null,mobileLayout:!1,popupTimer:setTimeout(function(){},100),constructor:function(a){this.setClassProperties(a),this.addLayers(),this.attachEventListeners()},setClassProperties:function(a){this.map=a.map,this.symbolConfig=a.symbolConfig,this.dataConfig=a.dataConfig,this.personQLyrInfo=a.dataConfig.personQueryLayerInfo,this.roomLyrInfo=a.dataConfig.roomLayerInfo,this.createInfoTemplates(),this.setUpInfoWindow(a.popupWrapper)},addLayers:function(){this.resultsLayer=this.map.addLayer(new k({id:"resultGraphicsLayer"})),this.resultsLayer.setInfoTemplate(this.popupInfo.popupTemplate)},attachEventListeners:function(){var a=this;d.subscribe("feature-find",b.hitch(this,this.featureFindHandler)),d.subscribe("map-center-complete",function(b){a.map.infoWindow.show(b.centerPoint)}),d.subscribe("dynamiclayer-defexpr-update",function(b){b.silent||a.hidePopupsAndClearResults()}),d.subscribe("window-resize",b.hitch(this,this.responsiveLayout))},createInfoTemplates:function(){this.popupInfo.allFields=_.map(this.roomLyrInfo.popupFields.concat(this.personQLyrInfo.popupFields),function(a){return _.extend(a,{visible:!0})}),this.popupInfo.formatFields=_.filter(this.roomLyrInfo.popupFields.concat(this.personQLyrInfo.popupFields),function(a){return a.formatter}),this.popupInfo.popupTemplate=new n({title:"Placeholder title",fieldInfos:this.popupInfo.allFields.push({fieldName:"ROOMNOTFOUND",label:"Room",visible:!0})}),this.popupInfo.popupTitleArr=this.roomLyrInfo.popupTitlePriority?this.roomLyrInfo.popupTitleField.concat(this.personQLyrInfo.popupTitleField):this.personQLyrInfo.popupTitleField.concat(this.roomLyrInfo.popupTitleField)},modifyPopupTemplate:function(a){var b=_.filter(this.popupInfo.allFields,function(b){return null!==a[b.fieldName]&&void 0!==a[b.fieldName]});this.popupInfo.popupTemplate.info.fieldInfos=b,_.each(this.popupInfo.formatFields,function(b){a[b.fieldName]&&(a[b.fieldName]=b.formatter(a[b.fieldName]))});var c=this;_.some(this.popupInfo.popupTitleArr,function(b){return a[b]||a[b]+0==a[b]?(c.popupInfo.popupTemplate.info.title=a[b],!0):!1}),this.popupInfo.popupTemplate.info.title||(this.popupInfo.popupTemplate.info.title="(no title)"),g.toggle(this.popupInfo.mobileTitle,"multi",this.popupInfo.popupTemplate.info.title.indexOf("<br>")>=0)},featureFindHandler:function(a){this.resultsLayer.clear(),a.roomAttr||(a.roomAttr={ROOMNOTFOUND:"Not Found"});var b=_.extend(a.roomAttr,a.personAttr);this.modifyPopupTemplate(b);var c=[this.addRoomGraphic(b,a.roomGeom)];this.map.infoWindow.setFeatures(c);var e=a.anchorGeom||(a.roomGeom?a.roomGeom.getExtent().getCenter():null);g.toggle(this.map.infoWindow.domNode,"no-anchor",!e),a.centerMap&&e?d.publish("map-center",e):this.map.infoWindow.show(e)},setUpInfoWindow:function(a){f.place(q,a),e(c(".close",a)[0],"click",b.hitch(this,this.hidePopupsAndClearResults));var d=new h({id:"resultsPopup"},"popup-pane");d.startup();var g=this.map.infoWindow,i=new m(null,f.create("div"));this.popupInfo.popups={original:g,mobile:i},this.popupInfo.mobileTitle=c(".title",i.domNode)[0],g.set("popupWindow",!1),this.popupInfo.fillSymbol=p.createSFSFromObject(this.symbolConfig),this.map.infoWindow.fillSymbol=this.popupInfo.fillSymbol,g.on("set-features",b.partial(this.genericPopupSelectFeatures,this,d)),g.on("clear-features",b.partial(this.onPopupClearFeatures,this,a)),i.on("set-features",b.partial(this.genericPopupSelectFeatures,this))},genericPopupSelectFeatures:function(a,b){var c=this;clearTimeout(a.popupTimer),b&&"resultsPopup"===b.id&&(b=b.domNode.parentElement),a.popupTimer=setTimeout(function(){b&&a.onPopupSelectFeatures(c.getSelectedFeature(),b)})},onPopupSelectFeatures:function(a,b){i.byId("resultsPopup").set("content",a.getContent()),this.reformatLinks(),this.showPopupParent(a,b),this.map.graphics.graphics.length<=0},onPopupClearFeatures:function(a,b){clearTimeout(a.popupTimer),a.popupTimer=setTimeout(function(){i.byId("resultsPopup").set("content",null),g.contains(b,"hide")||a.hidePopupParent(b)},400)},hidePopupParent:function(a){this.resultsLayer.clear(),g.add(a,"hide")},showPopupParent:function(a,b){g.remove(b,"hide")},addRoomGraphic:function(a,b){var c=new j(b,null,a);return this.resultsLayer.add(c),c},reformatLinks:function(){var a=c(".esriViewPopup a");_.each(a,function(a){var b=a.getAttribute("href");("mailto:"===b.substring(0,7)||"tel:"===b.substring(0,4))&&a.removeAttribute("target")})},hidePopupsAndClearResults:function(){this.hideOriginalPopup(),this.hideMobilePopup(),this.resultsLayer.clear()},hideOriginalPopup:function(){this.popupInfo.popups.original.hide(),this.popupInfo.popups.original.clearFeatures()},hideMobilePopup:function(){c(".esriMobileNavigationBar").style("display","none"),c(".esriMobilePopupInfoView").style("display","none"),this.popupInfo.popups.mobile.hide(),this.popupInfo.popups.mobile.clearFeatures()},responsiveLayout:function(a){a.h<o.breakHeight2||a.w<o.breakWidth1?this.mobileLayout||(this.hidePopupsAndClearResults(),this.map.setInfoWindow(this.popupInfo.popups.mobile),this.map.infoWindow.fillSymbol=this.popupInfo.fillSymbol,this.mobileLayout=!0):this.mobileLayout&&(this.hidePopupsAndClearResults(),this.map.setInfoWindow(this.popupInfo.popups.original),this.map.infoWindow.fillSymbol=this.popupInfo.fillSymbol,this.mobileLayout=!1)}})})},"app/controllers/WebmapLayerController":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/on","esri/layers/ArcGISDynamicMapServiceLayer","app/util/queryUtil","esri/tasks/QueryTask"],function(a,b,c,d,e){return a([],{map:null,locModel:null,dataConfig:null,allLayers:[],constructor:function(a){this.setClassProperties(a),this.addLayers(),this.attachEventListeners()},setClassProperties:function(a){this.map=a.map,this.locModel=a.locModel,this.dataConfig=a.dataConfig,this.buildingLyrInfo=a.dataConfig.buildingLayerInfo,this.mapServiceUrl=a.dataConfig.mapServiceUrl,this.constructLayerInfo()},attachEventListeners:function(){this.checkForFloorLoad(),this.locModel.on("floor-update",b.hitch(this,this.setDefExprs))},checkForFloorLoad:function(){return this.locModel.floor?(this.setDefExprs({silent:!0}),void(this.mapServiceLayer.loaded?this.setAllLayersVisible():d.once(this.mapServiceLayer,"load",b.hitch(this,this.setAllLayersVisible)))):void d.once(this.locModel,"floor-update",b.hitch(this,this.checkForFloorLoad))},addLayers:function(){this.mapServiceLayer=new e(this.mapServiceUrl,{id:"dataLayer"}),this.mapServiceLayer.setVisibleLayers([this.buildingLyrInfo.layerNum]),this.map.addLayer(this.mapServiceLayer)},constructLayerInfo:function(){var a=this;_.each(this.dataConfig,function(b){b&&b.layerNum+0===b.layerNum&&b.addToMap&&a.allLayers.push(b.layerNum)}),this.filterLayers=_.chain(this.dataConfig).filter(function(a){return a&&a.layerNum+0===a.layerNum&&a.floorFilter}).map(function(a){return{layerNum:a.layerNum,filterFunction:function(b,c){return a.buildingField+" = '"+b+"' AND "+a.floorField+" = '"+c+"'"}}}).value()},setAllLayersVisible:function(){this.mapServiceLayer.setVisibleLayers(this.allLayers)},setDefExprs:function(a){var b=[],d=this;_.each(this.filterLayers,function(a){b[a.layerNum]=a.filterFunction(d.locModel.building,d.locModel.floor)}),this.mapServiceLayer.setLayerDefinitions(b),c.publish("dynamiclayer-defexpr-update",{layerDefArr:b,silent:a&&a.silent?a.silent:!1})}})})},"app/models/LocationModel":function(){define(["dojo/_base/declare","dojo/_base/lang","app/util/queryUtil","esri/dijit/_EventedWidget"],function(a,b,c,d){return a(d,{floor:null,building:null,bldgExtent:null,site:null,siteExtent:null,availFloors:[],constructor:function(){},postCreate:function(){},startup:function(){},set:function(a,b,c){this.inherited(arguments),_.isObject(a)&&a.building&&!a.bldgExtent?this.emit("locModel-findBldgExtent",{building:a.building,floor:a.floor}):this.emit(a+"-update",{silent:c||!1})},silentSet:function(a,b){var c=this;_.isObject(a)?_.each(a,function(a,b){c.set(b,a,!0)}):this.set(a,b,!0)}})})},"app/util/queryUtil":function(){define(["dojo/_base/lang","dojo/topic","config/serverConfig","esri/layers/FeatureLayer","esri/tasks/query","esri/tasks/QueryTask","esri/tasks/RelationshipQuery"],function(a,b,c,d,e,f,g){return{createQuery:function(b){var c=new e;return a.mixin(c,b),c},createRelQuery:function(b){var c=new g;return a.mixin(c,b),c},createAndRun:function(a){a.query=this.createQuery(a.query),this.runQT(a)},createAndRunRelated:function(a){a.rq=this.createRelQuery(a.rq),this.runRelated(a)},runQT:function(c){b.publish("query-start");var d=new f(c.url);c.callbackArgs?d.execute(c.query,a.hitch(c.self,c.callback,c.callbackArgs),this.genericErrback):d.execute(c.query,a.hitch(c.self,c.callback),this.genericErrback)},runRelated:function(c){b.publish("query-start"),c.callbackArgs?c.layerToQuery.queryRelatedFeatures(c.rq).then(a.hitch(c.self,c.callback,c.callbackArgs),this.genericErrback):c.layerToQuery.queryRelatedFeatures(c.rq).then(a.hitch(c.self,c.callback),this.genericErrback)},constructWhere:function(a,b){var c=_.map(a,function(a){return a.newValue+0===a.newValue?a.fieldName+" = "+a.newValue:a.fieldName+" = '"+a.newValue+"'"});return c.push(this.getDirtyStr()),c.join(b)},getDirtyStr:function(){if(c.serverBug){var a=(new Date).getTime();return a+" = "+a}return""},constructWhereOr:function(a){return this.constructWhere(a," OR ")},constructWhereAnd:function(a){return this.constructWhere(a," AND ")},genericErrback:function(a){b.publish("query-done")},checkResponseSuccess:function(a){return a.error?(this.genericErrback(a.error),!1):!0},checkFeatureExistence:function(a){return!a.features||a.features.length<=0?!1:!0},checkSingleFeature:function(a){return 1!==a.features.length?!1:!0}}})},"app/util/symbolUtil":function(){define(["esri/renderers/SimpleRenderer","esri/symbols/SimpleFillSymbol"],function(a,b){return{createSFS:function(a,c,d){return new b({type:"esriSFS",style:"esriSFSSolid",color:a,outline:{type:"esriSLS",style:"esriSLSSolid",color:c,width:d}})},createSFSFromObject:function(a){return this.createSFS(a.fillColor,a.lineColor,a.lineWidth)},createSimpleRenderer:function(b,c,d){return new a({type:"simple",symbol:{color:b,type:"esriSFS",style:"esriSFSSolid",outline:{color:c,width:d,type:"esriSLS",style:"esriSLSSolid"}}})}}})},"app/views/LayoutView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/dom-attr","dojo/dom-style","dojo/dom-class","config/layoutConfig","esri/dijit/_EventedWidget","dijit/_TemplatedMixin","dojo/text!./templates/LayoutView.html"],function(a,b,c,d,e,f,g,h,i,j){return a([h,i],{templateString:j,constructor:function(){this.inherited(arguments)},postCreate:function(){this.inherited(arguments),this.setupClassVars(),this.attachEventListeners(),d.set(this.headerIcon,"src",this.config.headerIconLarge),e.set(this.headerTitle,"left",this.config.headerIconLargeWidth+20+"px"),this.headerTitle.innerHTML=this.config.headerTitle},startup:function(){this.inherited(arguments)},attachEventListeners:function(){this.attachWindowResize()},setupClassVars:function(){this.win=window,this.docEl=document.documentElement,this.docBody=document.getElementsByTagName("body")[0]},attachWindowResize:function(){var a=setTimeout(function(){},10),c=this;window.addEventListener?window.addEventListener("resize",function(){clearTimeout(a),a=setTimeout(b.hitch(c,c.publishWindowSize),500)}):window.attachEvent("onresize",function(){clearTimeout(a),a=setTimeout(b.hitch(c,c.publishWindowSize),500)})},publishWindowSize:function(){var a=this.win.innerHeight||this.docEl.clientHeight||this.docBody.clientHeight,b=this.win.innerWidth||this.docEl.clientWidth||this.docBody.clientWidth;
this.onWindowResize({h:a,w:b}),c.publish("window-resize",{h:a,w:b})},onWindowResize:function(a){f.remove(this.headerTitle,"small smaller smallest"),a.h<=g.breakHeight2||a.w<=g.breakWidth3?(d.set(this.headerIcon,"src",this.config.headerIconSmall),e.set(this.headerTitle,"left",this.config.headerIconSmallWidth+20+"px")):(d.set(this.headerIcon,"src",this.config.headerIconLarge),e.set(this.headerTitle,"left",this.config.headerIconLargeWidth+20+"px")),this.headerTitle.scrollWidth>this.headerTitle.offsetWidth&&(f.add(this.headerTitle,"small"),this.headerTitle.scrollWidth>this.headerTitle.offsetWidth&&(f.remove(this.headerTitle,"small"),f.add(this.headerTitle,"smaller")),this.headerTitle.scrollWidth>this.headerTitle.offsetWidth&&(f.remove(this.headerTitle,"smaller"),f.add(this.headerTitle,"smallest")))}})})},"app/views/MapButtonPanelView":function(){define(["dojo/_base/declare","dojo/topic","dojo/query","dojo/_base/lang","dojo/on","dojo/dom-construct","dojo/dom-class","dojo/dom","config/layoutConfig","esri/dijit/_EventedWidget","dijit/_TemplatedMixin","dojo/text!./templates/MapButtonView.html","dojo/text!./templates/MapPanelView.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){return a([j,k],{iconClass:null,templateString:m,mobileLayout:!1,constructor:function(){this.inherited(arguments)},postCreate:function(){this.domNode.id+="-panel",this.inherited(arguments);var a={iconClass:this.iconClass,buttonTitle:this.buttonTitle,id:this.id+"-toggle"},b=d.replace(l,a);this.mapToggle=f.place(b,this.toggleDiv)},startup:function(){this.inherited(arguments),this.placeAt(this.panelDiv),this.attachEventListeners()},attachEventListeners:function(){var a=this;e(this.mapToggle,"click",function(){g.toggle(a.domNode,"hide"),g.toggle(this,"highlight arrow-box"),b.publish("maptoggle-click",this),g.contains(a.domNode,"hide")||a.emit("mappanel-show")}),b.subscribe("maptoggle-click",function(b){b!==a.mapToggle&&a.hideSelf()}),b.subscribe("window-resize",d.hitch(this,this.responsiveLayout)),b.subscribe("mapcover-close",d.hitch(this,this.hideSelf))},hideSelf:function(){g.add(this.domNode,"hide"),g.remove(this.mapToggle,"highlight arrow-box")},responsiveLayout:function(a){a.h<i.breakHeight2||a.w<i.breakWidth1?this.mobileLayout||(this.placeAt(this.mobileView),g.add(this.mapToggle,"mobile-view"),this.mobileLayout=!0):this.mobileLayout&&(this.placeAt(this.panelDiv),g.remove(this.mapToggle,"mobile-view"),this.mobileLayout=!1)}})})},"app/views/MapCoverView":function(){define(["dojo/_base/declare","dojo/topic","dojo/query","dojo/_base/lang","dojo/on","dojo/dom-construct","dojo/dom-class","dojo/dom","dojo/NodeList-traverse","config/layoutConfig","esri/dijit/_EventedWidget","dijit/_TemplatedMixin","dojo/text!./templates/MapCoverView.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m){return a([k,l],{iconClass:null,templateString:m,constructor:function(){this.inherited(arguments)},postCreate:function(){this.inherited(arguments),this.attachEventListeners()},startup:function(){this.inherited(arguments),this.placeAt(this.containerDiv)},attachEventListeners:function(){var a=this;e(this.domNode,"click",function(b){b.target===this&&a.closeCover()}),b.subscribe("maptoggle-click",function(b){g.toggle(a.domNode,"push-down",!g.contains(b,"highlight"))}),b.subscribe("window-resize",d.hitch(this,this.responsiveLayout)),b.subscribe("function-finished",d.hitch(this,this.closeCover))},closeCover:function(){g.contains(this.domNode,"hide")||(g.add(this.domNode,"push-down"),b.publish("mapcover-close"))},responsiveLayout:function(a){a.h<j.breakHeight2||a.w<j.breakWidth1?g.remove(this.domNode,"hide"):g.add(this.domNode,"hide")}})})},"widgets/basemapgallery/BasemapGallery":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/dom-style","dojo/topic","dojo/on","esri/dijit/Basemap","esri/dijit/BasemapLayer","esri/dijit/BasemapGallery"],function(a,b,c,d,e,f,g,h,i){return a([],{constructor:function(a,b){this.postCreate(a,b)},postCreate:function(a,b){var c=new i({portalUrl:a.config.portalUrl,map:a.map,basemaps:this.createCustomBasemaps(a.config.customBasemaps),id:a.id},b);this.attachEventListeners(c,a),c.startup()},startup:function(){},attachEventListeners:function(a,c){a.on("load",b.partial(this.customizeBMG,c.config.basemapTitles)),a.on("selection-change",b.hitch(this,this.broadcastFunctionFinished)),f.once(a,"selection-change",b.partial(this.onFirstSelection,c.map)),e.subscribe("map-resize",b.hitch(this,this.onMapResize,a))},onFirstSelection:function(a){f.once(a,"update-end",b.hitch(this,function(){_.each(a.basemapLayerIds,function(b){_.contains(a.layerIds,b)&&a.removeLayer(a.getLayer(b))})}))},broadcastFunctionFinished:function(){e.publish("function-finished")},createCustomBasemaps:function(a){return _.map(a,function(a){return a.layers=_.map(a.baseMapLayers,function(a){return new h({url:a.url})}),new g(a)})},customizeBMG:function(a){var b=this,c=[];_.each(this.basemaps,function(b){_.contains(a,b.title)||b.layers||c.push(b.id)}),_.each(c,function(a){b.remove(a)})},onMapResize:function(a,b){this.domNodeHeight=_.min([.9*b.h-50,600]),d.set(a.domNode.parentElement,"maxHeight",this.domNodeHeight+"px")}})})},"widgets/bookmarks/BookmarksController":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","app/util/queryUtil","./BookmarksView"],function(a,b,c,d,e){return a([],{locModel:null,bldgStorage:{},constructor:function(a,b){this.dataConfig=a.dataConfig,this.locModel=a.locModel,this.buildingLyrInfo=a.dataConfig.buildingLayerInfo,this.postCreate(a,b)},postCreate:function(a,b){this.navView=new e({id:a.id},b),this.navView.startup()},startup:function(){this.getAllBuildingNames()},attachEventListeners:function(){var a=this;this.locModel.on("building-update",function(b){a.navView.updateSelectedBuilding(b.target.building)}),this.navView.on("bldg-change",function(b){c.publish("function-finished"),a.locModel.building!==b&&a.locModel.set({building:b,floor:null,bldgExtent:null})})},getAllBuildingNames:function(){d.createAndRun({query:{outFields:[this.buildingLyrInfo.buildingField,this.buildingLyrInfo.labelField],returnGeometry:!1,where:d.constructWhereAnd([{fieldName:1,newValue:1}])},url:this.dataConfig.buildingLayerInfo.url||this.dataConfig.mapServiceUrl+"/"+this.dataConfig.buildingLayerInfo.layerNum,self:this,callback:this.allBuildingsResponseHandler})},allBuildingsResponseHandler:function(a){this.getAllFloors(a.features)},getAllFloors:function(a){d.createAndRun({query:{outFields:[this.dataConfig.floorLayerInfo.buildingField],returnGeometry:!1,where:d.constructWhereAnd([{fieldName:1,newValue:1}])},url:this.dataConfig.floorLayerInfo.url||this.dataConfig.mapServiceUrl+"/"+this.dataConfig.floorLayerInfo.layerNum,self:this,callback:this.allFloorsResponseHandler,callbackArgs:a})},allFloorsResponseHandler:function(a,b){var c=this,d=_.chain(b.features).map(function(a){return a.attributes[c.dataConfig.floorLayerInfo.buildingField]}).uniq().value(),e=_.chain(a).filter(function(a){return _.contains(d,a.attributes[c.buildingLyrInfo.buildingField])}).map(function(a){return{value:a.attributes[c.buildingLyrInfo.buildingField],label:a.attributes[c.buildingLyrInfo.labelField]}}).sortBy(function(a){return a.label.replace(/\d+\s+/g,"")}).value();this.attachEventListeners(),this.navView.constructBuildingDropdown(e),this.navView.updateSelectedBuilding(this.locModel.building)}})})},"widgets/bookmarks/BookmarksView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/dom-construct","dojo/dom-attr","esri/dijit/_EventedWidget","dijit/_TemplatedMixin","dojo/text!./BookmarksView.html"],function(a,b,c,d,e,f,g,h){return a([f,g],{templateString:h,constructor:function(){this.inherited(arguments)},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments),this.attachListeners()},attachListeners:function(){c(this.buildingDropdown,"change",b.partial(this.onSelectionChange,this))},onSelectionChange:function(a){var b=this.options[this.selectedIndex];b&&a.emit("bldg-change",b.value)},createOption:function(a,b){return d.create("option",{value:b.value,label:b.label||b.value,innerHTML:b.label||b.value},a)},constructBuildingDropdown:function(a){_.each(a,b.partial(this.createOption,this.buildingDropdown))},updateSelectedBuilding:function(a){a||(a="");var b=_.some(this.buildingDropdown.options,function(b){return b.value===a});b&&(this.buildingDropdown.value=a)}})})},"widgets/buildingbutton/BuildingButton":function(){define(["dojo/_base/declare","dojo/on","dojo/topic","esri/dijit/_EventedWidget","dijit/_TemplatedMixin","dojo/text!./buildingButtonView.html"],function(a,b,c,d,e,f){return a([d,e],{templateString:f,id:"buildingButton",constructor:function(a){this.inherited(arguments),this.containerDiv=a.containerDiv},postCreate:function(){this.inherited(arguments),this.attachEventListeners()},startup:function(){this.inherited(arguments),this.placeAt(this.containerDiv)},attachEventListeners:function(){var a=this;b(this.domNode,"click",function(){a.locModel.bldgExtent&&c.publish("map-changeExtent",a.locModel.bldgExtent.expand(1.2))})}})})},"widgets/floorpicker/FloorPicker":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","./FloorPickerView"],function(a,b,c,d){return a([],{locModel:null,constructor:function(a){this.containerDiv=a.containerDiv,this.locModel=a.locModel,this.inherited(arguments),this.postCreate()},postCreate:function(){this.inherited(arguments),this.pickerView=new d({locModel:this.locModel,containerDiv:this.containerDiv},null),this.pickerView.startup()},startup:function(){this.inherited(arguments),this.attachEventListeners()},attachEventListeners:function(){var a=this;c.subscribe("map-zoom-end",function(b){a.pickerView.adjustVisibility(b.level)}),this.locModel.on("availFloors-update",b.hitch(this,this.onAvailFloorsUpdate)),this.locModel.on("floor-update",b.hitch(this,this.onFloorUpdate))},onAvailFloorsUpdate:function(){this.pickerView.constructUI()},onFloorUpdate:function(){this.pickerView.updateHighlightedFloor()},testFloorPicker:function(){this.locModel.set("availFloors",["5M","03","B","8","12","1","3"])}})})},"widgets/floorpicker/FloorPickerView":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/dom-style","dojo/dom-class","dojo/dom-attr","dojo/query","dojo/on","dojo/NodeList-dom","esri/dijit/_EventedWidget","dijit/_TemplatedMixin","dojo/text!./FloorPickerView.html"],function(a,b,c,d,e,f,g,h,i,j,k,l){return a([j,k],{templateString:l,baseClass:"vertical",locModel:null,id:"floorPicker",constructor:function(){this.inherited(arguments)},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments),this.placeAt(this.containerDiv),this.addEventListeners()},addEventListeners:function(){var a=d.get(this.scrollUp,"font-size")||d.get(this.scrollUp,"fontSize"),c=2*parseInt(a,10);h(this.scrollUp,"click",b.hitch(this,this.scrollAnimate,this.floorsDiv,c,-1)),h(this.scrollDown,"click",b.hitch(this,this.scrollAnimate,this.floorsDiv,c,1))},adjustScrollButtons:function(){if(!(g(".no-media-queries").length||this.locModel.availFloors.length<=5)){var a=g(".btn",this.floorsDiv)[0],b=g(".btn:last-child",this.floorsDiv)[0],c=this.floorsDiv.getBoundingClientRect();e.toggle(this.scrollUp,"disabled",a&&a.getBoundingClientRect().top>=c.top),e.toggle(this.scrollDown,"disabled",b&&b.getBoundingClientRect().bottom<=c.bottom)}},scrollAnimate:function(a,b,c){var d=0,e=this,f=setInterval(function(){d++,a.scrollTop+=c,d>=b&&(clearInterval(f),e.adjustScrollButtons())},5)},adjustVisibility:function(a){17>a?e.add(this.domNode,"hide"):(e.remove(this.domNode,"hide"),this.scrollHighlightedIntoView())},constructUI:function(){var a=this;c.empty(this.floorsDiv),this.locModel.availFloors.length>5?(e.remove(this.scrollUp,"hide disabled"),e.remove(this.scrollDown,"hide disabled"),e.add(this.domNode,"set-height")):(e.add(this.scrollUp,"hide"),e.add(this.scrollDown,"hide"),e.remove(this.domNode,"set-height")),this.locModel.availFloors.sort(function(a,b){var c=parseInt(a,10),d=parseInt(b,10);return isNaN(c)&&isNaN(d)||c===d?b>a?-1:a>b?1:0:isNaN(c)?-1:isNaN(d)?1:c-d}),_.each(this.locModel.availFloors,function(d){c.create("div",{"class":"btn",innerHTML:d,"data-floornum":d,click:b.hitch(a,a.floorButtonClick,d)},a.floorsDiv,"first")}),this.updateHighlightedFloor()},updateHighlightedFloor:function(){var a=this,b=g(".btn",this.floorsDiv);_.each(b,function(b){e.toggle(b,"highlight",f.get(b,"data-floornum")===a.locModel.floor)}),this.scrollHighlightedIntoView()},scrollHighlightedIntoView:function(){if(!(this.locModel.availFloors.length<=5)){var a=g(".highlight",this.domNode)[0];a&&(a.scrollIntoViewIfNeeded?a.scrollIntoViewIfNeeded():a.scrollIntoView&&a.scrollIntoView()),this.adjustScrollButtons()}},floorButtonClick:function(a){a!==this.locModel.floor&&this.locModel.set("floor",a)}})})},"widgets/legend/LegendController":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/dom-construct","dojo/dom-style","dojo/topic","dojo/on","esri/dijit/Legend"],function(a,b,c,d,e,f,g){return a([],{constructor:function(a,b){this.postCreate(a,b)},postCreate:function(a,b){var c=this.createLayerInfos(a.dataConfig,a.map),d=new g({map:a.map,layerInfos:c,baseClass:!a.dataConfig.mapServiceUrl||a.dataConfig.hideLegendSubtitles?"hide-subtitles":"show-subtitles",id:a.id},b);this.attachEventListeners(d,a),d.startup()},startup:function(){},attachEventListeners:function(a,c){c.locModel.floor||f.once(c.locModel,"floor-update",function(){a.refresh()}),f(a.domNode,"click",b.partial(e.publish,"function-finished")),e.subscribe("map-resize",b.hitch(this,this.onMapResize,a))},broadcastFunctionFinished:function(){e.publish("function-finished")},createLayerInfos:function(a,b){if(a.mapServiceUrl){var c=[];return _.each(a,function(a){a&&a.layerNum+0===a.layerNum&&a.addToMap&&!a.showInLegend&&c.push(a.layerNum)}),[{title:a.legendTitle,layer:b.getLayer("dataLayer"),hideLayers:c}]}var d=[];return _.each(a,function(a,c){a&&a.layerNum+0===a.layerNum&&a.addToMap&&a.showInLegend&&d.push({title:a.titleForLegend,layer:b.getLayer(c.replace("Info",""))})}),d},onMapResize:function(a,b){this.domNodeHeight=_.min([.9*b.h-50,550]),d.set(a.domNode.parentElement,"maxHeight",this.domNodeHeight+"px")}})})},"widgets/loader/LoadIndicator":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/on","dojo/topic","dojo/dom-class","esri/dijit/_EventedWidget","dijit/_TemplatedMixin","dojo/text!./LoadIndicatorView.html"],function(a,b,c,d,e,f,g,h){return a([f,g],{templateString:h,id:"load-indicator",constructor:function(a){this.inherited(arguments),this.containerDiv=a.containerDiv},postCreate:function(){this.inherited(arguments),this.attachEventListeners()},startup:function(){this.inherited(arguments),this.placeAt(this.containerDiv)},attachEventListeners:function(){d.subscribe("query-start",b.hitch(this,this.showIndicator)),d.subscribe("map-update-start",b.hitch(this,this.showIndicator)),d.subscribe("query-done",b.hitch(this,this.hideIndicator)),d.subscribe("map-update-end",b.hitch(this,this.hideIndicator))},hideIndicator:function(){e.add(this.domNode,"hide")},showIndicator:function(){e.remove(this.domNode,"hide")}})})},"widgets/newlayersearch/NewLayerSearch":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/promise/all","dojo/topic","esri/tasks/QueryTask","app/util/queryUtil","./NewLayerSearchView"],function(a,b,c,d,e,f,g){return a([],{locModel:null,viewElement:null,constructor:function(a,b){this.inherited(arguments),this.postCreate(a,b)},postCreate:function(a,b){this.inherited(arguments),this.lsView=new g({id:a.id,viewWidget:a.viewWidget,searchDelay:400},b),this.setUpClassProperties(a),this.lsView.startup()},startup:function(){this.inherited(arguments),this.attachEventListeners()},setUpClassProperties:function(a){this.mapServiceUrl=a.dataConfig.mapServiceUrl,this.roomLyrInfo=a.dataConfig.roomLayerInfo,this.personLyrInfo=a.dataConfig.personQueryLayerInfo,this.roomQ=f.createQuery({outFields:_.union(this.roomLyrInfo.queryFields,this.roomLyrInfo.queryLabelFields,[this.roomLyrInfo.oidField]),returnGeometry:!1}),this.personQ=f.createQuery({outFields:_.union(this.personLyrInfo.queryFields,this.personLyrInfo.queryLabelFields,[this.personLyrInfo.oidField]),returnGeometry:!1})},attachEventListeners:function(){this.lsView.on("input-change",b.hitch(this,this.handleSearchStr)),this.lsView.on("select-oid",b.hitch(this,this.handleResultSelection))},handleSearchStr:function(a){if(this.lsView.inputValue&&this.lsView.inputValue===a){this.roomQ.where=this.constructWhere(this.roomLyrInfo.queryFields,a),this.personQ.where=this.constructWhere(this.personLyrInfo.queryFields,a);var d=new e(this.roomLyrInfo.url||this.mapServiceUrl+"/"+this.roomLyrInfo.layerNum),g=new e(this.personLyrInfo.url||this.mapServiceUrl+"/"+this.personLyrInfo.layerNum);c({room:d.execute(this.roomQ),person:g.execute(this.personQ)}).then(b.hitch(this,this.handleQueryResults),f.genericErrback)}},constructWhere:function(a,b){var c=b.toUpperCase().replace(/'/g,"''"),d=_.map(a,function(a){return"UPPER("+a+") LIKE '%"+c+"%'"}),e=d.join(" OR "),g=f.getDirtyStr();return g&&(e="("+e+") AND "+g),e},handleQueryResults:function(a){var b=this,c=[];_.each(a,function(a,d){if(f.checkResponseSuccess(a)&&f.checkFeatureExistence(a)){var e=_.map(a.features,function(a){var c=d+"LyrInfo";return{oid:a.attributes[b[c].oidField],label:b[c].queryLabelFunction(a.attributes),layer:d,iconClass:b[c].queryIconClass}});c=c.concat(e)}}),this.lsView.handleFormattedResults(c)},handleResultSelection:function(a){d.publish("search-select-oid",_.omit(a,"target")),d.publish("function-finished")}})})},"widgets/newlayersearch/NewLayerSearchView":function(){define(["dojo/_base/declare","dojo/_base/event","dojo/_base/lang","dojo/dom-construct","dojo/dom-style","dojo/dom-class","dojo/dom-attr","dojo/topic","dojo/query","dojo/keys","dojo/on","dojo/NodeList-dom","dojo/NodeList-traverse","esri/dijit/_EventedWidget","dijit/_TemplatedMixin","dijit/focus","dojo/text!./NewLayerSearchView.html"],function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){return a([n,o],{templateString:q,locModel:null,id:"layerSearch",inputTimeout:setTimeout(function(){},100),inputValue:"",minChars:3,constructor:function(){this.inherited(arguments)},postCreate:function(){this.inherited(arguments)},startup:function(){this.inherited(arguments),this.addEventListeners()},addEventListeners:function(){h.subscribe("map-resize",c.hitch(this,this.onMapResize)),k(this.viewWidget,"mappanel-show",c.hitch(this,this.focus)),k(this.inputNode,"keyup",c.hitch(this,this.onInputKeyUp)),k(this.inputNode,"keydown",c.hitch(this,this.onInputKeyDown)),k(this.submitNode,"click",c.hitch(this,this.onInputKeyUp)),k(this.clearNode,"click",c.hitch(this,this.clear)),k(this.resultsNode,"click",c.hitch(this,this.resultClickHandler)),k(this.resultsNode,"keydown",c.hitch(this,this.resultKeydownHandler))},focus:function(){p.focus(this.inputNode);var a=this;setTimeout(function(){a.inputNode.scrollIntoViewIfNeeded?a.inputNode.scrollIntoViewIfNeeded():a.inputNode.scrollIntoView&&a.inputNode.scrollIntoView()},500)},blur:function(){this.inputNode.blur(),this.clearResults()},clear:function(){g.set(this.inputNode,"value",""),this.inputValue="",f.remove(this.containerNode,"has-input"),f.remove(this.domNode,"search-error"),this.clearResults(),this.focus(),this.emit("clear")},clearResults:function(){d.empty(this.resultsNode),this.clearSearchError()},hideResultsNode:function(){f.add(this.resultsNode,"hide")},onInputKeyUp:function(a){if(a&&!a.ctrlKey&&!a.metaKey&&!a.altKey&&a.keyCode!==j.copyKey&&a.keyCode!==j.ALT&&a.keyCode!==j.CTRL&&a.keyCode!==j.META&&a.keyCode!==j.SHIFT&&a.keyCode!==j.UP_ARROW&&a.keyCode!==j.DOWN_ARROW&&a.keyCode!==j.LEFT_ARROW&&a.keyCode!==j.RIGHT_ARROW){if(this.clearInputTimeout(),this.inputValue=this.inputNode.value||"",""===this.inputValue)return f.remove(this.containerNode,"has-input"),void this.clearResults();if(a.keyCode===j.ESCAPE||a.keyCode===j.TAB)this.clearResults(),this.emit("search-cancel");else{if(this.inputValue.length<this.minChars&&a.keyCode&&a.keyCode!==j.ENTER)return this.clearResults(),void f.add(this.containerNode,"has-input");this.inputTimeout=setTimeout(c.hitch(this,this.handleInput),this.searchDelay)}}},handleInput:function(){f.add(this.containerNode,"loading has-input"),this.emit("input-change",this.inputValue)},onInputKeyDown:function(a){if(a){var c=i(".LSResult",this.resultsNode);if(c.length)switch(a.keyCode){case j.TAB:break;case j.UP_ARROW:b.stop(a),c[c.length-1].focus();break;case j.DOWN_ARROW:b.stop(a),c[0].focus()}}},resultClickHandler:function(a){this.selectFeatureFromResult(a.target)},resultKeydownHandler:function(a){return a.keyCode===j.ENTER?void this.selectFeatureFromResult(a.target):void((a.keyCode===j.DOWN_ARROW||a.keyCode===j.UP_ARROW)&&(b.stop(a),this.adjustResultFocus(a.keyCode,a.target)))},adjustResultFocus:function(a,b){var c=i(".LSResult"),d=parseInt(g.get(b,"data-idx"),10);if(a===j.DOWN_ARROW&&d+1===c.length||a===j.UP_ARROW&&0===d)this.inputNode.focus();else{var e=a===j.DOWN_ARROW?d+1:d-1;c[e].focus()}},selectFeatureFromResult:function(a){var b=i(a).closest("li")[0],c=b.innerText||b.textContent;c||(c="Browser error!"),c=c.trim?c.trim():c.replace(/^\s+|\s+$/g,""),g.set(this.inputNode,"value",c),this.clearResults(),this.emit("select-oid",{oid:g.get(b,"data-oid"),lyr:g.get(b,"data-lyr")})},clearInputTimeout:function(){clearTimeout(this.inputTimeout)},handleFormattedResults:function(a){if(f.remove(this.containerNode,"loading"),f.add(this.containerNode,"has-input"),!a.length)return void this.handleNoResults();this.clearSearchError();var b=new RegExp("("+this.inputValue+")","gi"),c=d.create("ul",{"class":"resultsList"});_.each(a,function(a,e){var f=a.label.replace(b,"<strong>$1</strong>");d.create("li",{"class":"LSResult","data-oid":a.oid,"data-lyr":a.layer,"data-idx":e,tabindex:"0",innerHTML:'<span class="search-results-icon '+a.iconClass+'"></span> '+f+"</li>"},c)}),d.empty(this.resultsNode),d.place(c,this.resultsNode)},clearSearchError:function(){f.remove(this.domNode,"search-error")},handleNoResults:function(){d.empty(this.resultsNode),f.add(this.domNode,"search-error")},onMapResize:function(a){this.searchResultsHeight=_.min([.8*a.h-50,450]),e.set(this.resultsNode,"maxHeight",this.searchResultsHeight+"px")}})})},"widgets/overviewmap/OverviewMap":function(){define(["dojo/_base/declare","dojo/_base/lang","dojo/topic","dojo/on","esri/dijit/OverviewMap","esri/layers/ArcGISTiledMapServiceLayer","esri/layers/ArcGISDynamicMapServiceLayer"],function(a,b,c,d,e,f,g){return a([],{constructor:function(a){this.mapServiceUrl=a.mapServiceUrl,this.config=a.config,this.overviewMapDijit=new e({id:"ovm",map:a.map,attachTo:"bottom-left",visible:a.config.openOnLoad,expandFactor:3,baseLayer:new f(a.config.basemapUrl),opacity:1})},startup:function(){this.overviewMapDijit.startup(),this.mapServiceUrl&&(this.setupDataLayer(),this.addDataLayer()),this.attachEventListeners()},attachEventListeners:function(){c.subscribe("map-resize",b.hitch(this,this.onMapResize))},setupDataLayer:function(){this.dataLayer=new g(this.mapServiceUrl),c.subscribe("dynamiclayer-defexpr-update",b.hitch(this,this.setDefExprs))},onMapResize:function(a){var b=this;return this.overviewMapDijit.visible?void(this.overviewMapDijit.map&&this.overviewMapDijit.overviewMap&&this.overviewMapDijit.overviewMap.loaded?this.resizeOverviewMap(a):this.setResizeInterval(a)):void d.once(this.overviewMapDijit.domNode,"click",function(){b.setResizeInterval(a)})},resizeOverviewMap:function(a){var b=a&&a.h?a.h:this.overviewMapDijit.map.height,c=a&&a.w?a.w:this.overviewMapDijit.map.width,d=Math.min(Math.max(b/4,100),250),e=Math.min(Math.max(c/4,100),250);this.overviewMapDijit.resize({h:d,w:e})},setResizeInterval:function(a){var b=this,c=0,d=setInterval(function(){b.overviewMapDijit.overviewMap&&b.overviewMapDijit.overviewMap.loaded?(clearInterval(d),b.resizeOverviewMap(a)):c>10?clearInterval(d):c++},1e3)},addDataLayer:function(){this.dataLayer.setVisibleLayers(this.config.visibleLayers);var a=this;if(this.overviewMapDijit.visible)var b=0,c=setInterval(function(){a.overviewMapDijit.overviewMap&&a.overviewMapDijit.overviewMap.loaded?(clearInterval(c),a.setDefExprsAndAdd()):b>30?clearInterval(c):b++},1e3);else d.once(this.overviewMapDijit.domNode,"click",function(){a.setDefExprsAndAdd()})},setDefExprsAndAdd:function(){if(!this.dataLayer.layerDefinitions||!this.dataLayer.layerDefinitions.length){var a=this.overviewMapDijit.map.getLayer("dataLayer");a&&this.setDefExprs({layerDefArr:a.layerDefinitions})}this.overviewMapDijit.overviewMap.addLayer(this.dataLayer)},setDefExprs:function(a){this.dataLayer.setLayerDefinitions(a.layerDefArr)}})})},"url:app/views/templates/LayoutView.html":'<div><div id="header" class="bottom-shadow" data-dojo-attach-point="header"><img id="header-icon" data-dojo-attach-point="headerIcon"></img><div id="header-title" data-dojo-attach-point="headerTitle"></div></div><div id="map-container"><div id="map-buttons-horizontal"></div><div id="map-panels-horizontal" class="outline-shadow"></div><div id="popupWrapper" class="map-panel hide outline-shadow"></div></div></div>',"url:app/views/templates/MapButtonView.html":'<div id="{id}" class="map-toggle btn"><i class="fa {iconClass}" data-dojo-attach-point="icon-div" title="{buttonTitle}"></i></div>',"url:app/views/templates/MapCoverView.html":'<div class="push-down hide"></div>',"url:app/views/templates/MapPanelView.html":'<div class="map-panel hide panel-wrapper"><div data-dojo-attach-point="replaceDiv"></div></div>',"url:app/views/templates/PopupView.html":'<div class="pane-header"><div class="btn close" title="Close"><i class="fa fa-close"></i></div></div><div class="popup" id="popup-pane"></div>',"url:widgets/bookmarks/BookmarksView.html":'<div id="bookmarks"><select data-dojo-attach-point="buildingDropdown"><option value="" label="Choose a building">Choose a building</option></select></div>',"url:widgets/buildingbutton/buildingButtonView.html":'<div class="btn" title="Zoom to Full Building"><i class="fa fa-building-o"></i></div>',"url:widgets/floorpicker/FloorPickerView.html":'<div><div class="full-dim picker-wrapper"><div data-dojo-attach-point="scrollUp" class="btn hide scroll-btn" title="Scroll Up"><i class="fa fa-chevron-up"></i></div><div data-dojo-attach-point="floorsDiv" class="floors-div" title="Change Floors"></div><div data-dojo-attach-point="scrollDown" class="btn hide scroll-btn" title="Scroll Down"><i class="fa fa-chevron-down"></i></div></div></div>',"url:widgets/loader/LoadIndicatorView.html":'<div id="load-indicator"><i class="fa fa-spinner fa-spin"></i></div>',"url:widgets/newlayersearch/NewLayerSearchView.html":'<div class="simpleLS"><div class="LayerSearcher" data-dojo-attach-point="containerNode"><div title="Search" tabindex="0" class="LSSearch LSIcon" data-dojo-attach-point="submitNode"><i class="fa fa-search"></i></div><div class="input-wrapper"><input id="${id}-input" tabindex="0" placeholder="Search for rooms and people" value="${inputValue}" autocomplete="off" type="text" data-dojo-attach-point="inputNode"></div><div tabindex="0" class="LSReset LSIcon" data-dojo-attach-point="clearNode"><i class="fa fa-close"></i></div><div tabindex="0" class="LSLoading LSIcon"><i class="fa fa-spin fa-spinner"></i></div></div><div class="LSResults" data-dojo-attach-point="resultsNode"></div></div>'}});