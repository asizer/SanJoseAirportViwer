require({
cache: {
// Source: lib/esri/dijit/Legend.js
'esri/dijit/Legend': function() {
//>>built
define(["dojo/_base/kernel","dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/json","dojo/_base/Color","dojo/has","dojo/sniff","dojo/DeferredList","dojo/json","dojo/number","dojo/dom","dojo/dom-construct","dojo/dom-style","dijit/_Widget","dojox/gfx","dojox/gfx/matrix","dojox/html/entities","../kernel","../config","../request","../lang","../renderers/SimpleRenderer","../renderers/UniqueValueRenderer","../renderers/ClassBreaksRenderer","../renderers/ScaleDependentRenderer","../renderers/DotDensityRenderer","../renderers/TemporalRenderer","../renderers/HeatmapRenderer","../symbols/SimpleMarkerSymbol","../symbols/PictureFillSymbol","../symbols/jsonUtils","./_EventedWidget","dojo/i18n!../nls/jsapi","dojo/i18n!dojo/cldr/nls/number"],function(A,K,s,m,n,L,y,v,$,M,N,F,q,e,t,O,G,P,Q,aa,H,I,D,B,J,E,R,S,T,U,V,W,C,X,Y,Z){var x=K([X,O],{declaredClass:"esri.dijit.Legend",widgetsInTemplate:!1,layers:null,alignRight:!1,hoverLabelShowing:!1,dotDensitySwatchSize:26,dotCoverage:75,reZeros:RegExp("\\"+Z.decimal+"0+$","g"),reZerosFractional:RegExp("(\\d)0*$","g"),_ieTimer:100,_isRightToLeft:!1,_align:null,_legendAlign:null,constructor:function(a,b){s.mixin(this,Y.widgets.legend);a=a||{};a.map?b?(this.map=a.map,this.layerInfos=a.layerInfos,this._respectCurrentMapScale=
!1===a.respectCurrentMapScale?!1:!0,this.arrangement=a.arrangement===x.ALIGN_RIGHT?x.ALIGN_RIGHT:x.ALIGN_LEFT,this.arrangement===x.ALIGN_RIGHT&&(this.alignRight=!0),this.autoUpdate=!1===a.autoUpdate?!1:!0,this._surfaceItems=[]):console.error("esri.dijit.Legend: must specify a container for the legend"):console.error("esri.dijit.Legend: unable to find the 'map' property in parameters")},postMixInProperties:function(){this.inherited(arguments);var a=["ar","he"],b,c;for(b=0;b<a.length;b+=1)c=a[b],A.locale&&
-1!==A.locale.indexOf(c)&&(-1!==A.locale.indexOf("-")?-1!==A.locale.indexOf(c+"-")&&(this._isRightToLeft=!0):this._isRightToLeft=!0);this._isRightToLeft?(this._align=this.alignRight?"left":"right",this._legendAlign=this.alignRight?"esriLegendLeft":"esriLegendRight"):(this._align=this.alignRight?"right":"left",this._legendAlign=this.alignRight?"esriLegendRight":"esriLegendLeft")},startup:function(){this.inherited(arguments);this._initialize();9>v("ie")&&(this._repaintItems=s.hitch(this,this._repaintItems),
setTimeout(this._repaintItems,this._ieTimer))},destroy:function(){this._deactivate();this._removeHoverHandlers();this.inherited(arguments)},refresh:function(a){if(this.domNode){a?(this.layerInfos=a,this.layers=[],m.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(a.layer._hideLayersInLegend=a.hideLayers,this._addSubLayersToHide(a)):a.layer._hideLayersInLegend=[],
a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this)):this.useAllMapLayers&&(this.layers=this.layerInfos=null);for(a=this.domNode.children.length-1;0<=a;a--)e.destroy(this.domNode.children[a]);this._removeHoverHandlers();this.startup()}},_legendUrl:"http://utility.arcgis.com/sharing/tools/legend",_initialize:function(){this.layerInfos&&(this.layers=[],m.forEach(this.layerInfos,function(a){this._isSupportedLayerType(a.layer)&&
(a.title&&(a.layer._titleForLegend=a.title),a.layer._hideDefaultSymbol=!1===a.defaultSymbol?!0:!1,a.hideLayers?(a.layer._hideLayersInLegend=a.hideLayers,this._addSubLayersToHide(a)):a.layer._hideLayersInLegend=[],a.hoverLabel&&(a.layer._hoverLabel=a.hoverLabel),a.hoverLabels&&(a.layer._hoverLabels=a.hoverLabels),this.layers.push(a.layer))},this));this.useAllMapLayers=!1;if(!this.layers){this.useAllMapLayers=!0;this.layers=[];var a=[],b=[];m.forEach(this.map.layerIds,function(c){c=this.map.getLayer(c);
var d;this._isSupportedLayerType(c)&&(c.arcgisProps&&c.arcgisProps.title&&(c._titleForLegend=c.arcgisProps.title),this.layers.push(c));"esri.layers.KMLLayer"==c.declaredClass&&(d=c.getLayers(),m.forEach(d,function(b){a.push(b.id)},this));"esri.layers.GeoRSSLayer"==c.declaredClass&&(d=c.getFeatureLayers(),m.forEach(d,function(a){b.push(a.id)},this))},this);m.forEach(this.map.graphicsLayerIds,function(c){var d=this.map.getLayer(c);-1==m.indexOf(a,c)&&-1==m.indexOf(b,c)&&(this._isSupportedLayerType(d)&&
d._params&&d._params.drawMode)&&(d.arcgisProps&&d.arcgisProps.title&&(d._titleForLegend=d.arcgisProps.title),this.layers.push(d))},this)}this._createLegend()},_activate:function(){this._deactivate();this.autoUpdate&&(this._respectCurrentMapScale&&(this._ozeConnect=n.connect(this.map,"onZoomEnd",this,"_refreshLayers")),this.useAllMapLayers&&(this._olaConnect=n.connect(this.map,"onLayerAdd",this,"_updateAllMapLayers"),this._olrConnect=n.connect(this.map,"onLayerRemove",this,"_updateAllMapLayers"),this._olroConnect=
n.connect(this.map,"onLayersReordered",this,"_updateAllMapLayers")),m.forEach(this.layers,function(a){a.ovcConnect=n.connect(a,"onVisibilityChange",this,"_refreshLayers");a.oscConnect=n.connect(a,"onScaleRangeChange",this,"_refreshLayers");"esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass&&a.supportsDynamicLayers&&(a.odcConnect=n.connect(a,"_onDynamicLayersChange",s.hitch(this,"_updateDynamicLayers",a)));"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&(a.oirConnect=n.connect(a,
"onRenderingChange",s.partial(this._updateImageServiceLayers,this,a)))},this))},_deactivate:function(){this._ozeConnect&&n.disconnect(this._ozeConnect);this._olaConnect&&n.disconnect(this._olaConnect);this._olroConnect&&n.disconnect(this._olroConnect);this._olrConnect&&n.disconnect(this._olrConnect);m.forEach(this.layers,function(a){a.ovcConnect&&n.disconnect(a.ovcConnect);a.oscConnect&&n.disconnect(a.oscConnect);a.odcConnect&&n.disconnect(a.odcConnect);a.oirConnect&&n.disconnect(a.oirConnect)},this)},
_updateDynamicLayers:function(a){delete a.legendResponse;this._refreshLayers()},_updateImageServiceLayers:function(a,b){delete b.legendResponse;a._refreshLayers()},_refreshLayers:function(){this.refresh()},_updateAllMapLayers:function(){this.layers=[];m.forEach(this.map.layerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&this.layers.push(a)},this);m.forEach(this.map.graphicsLayerIds,function(a){a=this.map.getLayer(a);this._isSupportedLayerType(a)&&(a._params&&a._params.drawMode)&&
this.layers.push(a)},this);this.refresh()},_createLegend:function(){var a=!1;t.set(this.domNode,"position","relative");e.create("div",{id:this.id+"_msg",className:"esriLegendMsg",innerHTML:this.NLS_creatingLegend+"..."},this.domNode);var b=[];m.forEach(this.layers,function(c){if("esri.layers.KMLLayer"==c.declaredClass||"esri.layers.GeoRSSLayer"==c.declaredClass){var f;c.loaded?("esri.layers.KMLLayer"==c.declaredClass?f=c.getLayers():"esri.layers.GeoRSSLayer"==c.declaredClass&&(f=c.getFeatureLayers(),
c._hideLayersInLegend&&(f=m.filter(f,function(a){return-1==m.indexOf(c._hideLayersInLegend,a.id)}))),m.forEach(f,function(a){"esri.layers.FeatureLayer"==a.declaredClass&&c._titleForLegend&&(a._titleForLegend=c._titleForLegend+" - ","esriGeometryPoint"==a.geometryType?a._titleForLegend+=this.NLS_points:"esriGeometryPolyline"==a.geometryType?a._titleForLegend+=this.NLS_lines:"esriGeometryPolygon"==a.geometryType&&(a._titleForLegend+=this.NLS_polygons),b.push(a))},this)):n.connect(c,"onLoad",s.hitch(this,
function(){this.refresh(this.layerInfos)}))}else if("esri.layers.WMSLayer"===c.declaredClass)if(c.loaded){if(c.visible&&0<c.layerInfos.length&&m.some(c.layerInfos,function(a){return a.legendURL})){var g=!1;m.forEach(c.layerInfos,function(b){b.legendURL&&-1<m.indexOf(c.visibleLayers,b.name)&&(g||(e.create("div",{innerHTML:"\x3cspan class\x3d'esriLegendServiceLabel'\x3e"+(c._titleForLegend||c.name||c.id)+"\x3c/span\x3e"},this.domNode),g=!0),e.create("div",{innerHTML:"\x3cimg src\x3d'"+b.legendURL+"'/\x3e"},
this.domNode),a=!0)},this)}}else n.connect(c,"onLoad",s.hitch(this,function(){this.refresh(this.layerInfos)}));else b.push(c)},this);var c=[];m.forEach(b,function(a){if(a.loaded){if(!0===a.visible&&(a.layerInfos||a.renderer||"esri.layers.ArcGISImageServiceLayer"==a.declaredClass)){var b=e.create("div",{id:this.id+"_"+a.id,style:{display:"none"},"class":"esriLegendService"});e.create("span",{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},e.create("td",{align:this._align},e.create("tr",
{},e.create("tbody",{},e.create("table",{width:"95%"},b)))));e.place(b,this.id,"first");a.legendResponse||a.renderer?this._createLegendForLayer(a):c.push(this._legendRequest(a))}}else var g=n.connect(a,"onLoad",this,function(a){n.disconnect(g);g=null;this.refresh()})},this);0===c.length&&!a?(q.byId(this.id+"_msg").innerHTML=this.NLS_noLegend,this._activate()):(new M(c)).addCallback(s.hitch(this,function(b){a?q.byId(this.id+"_msg").innerHTML="":q.byId(this.id+"_msg").innerHTML=this.NLS_noLegend;this._activate()}))},
_createLegendForLayer:function(a){if(a.legendResponse||a.renderer){var b=!1;if(a.legendResponse){var c=a.dynamicLayerInfos||a.layerInfos;c&&c.length?m.forEach(c,function(c,f){if(!a._hideLayersInLegend||-1==m.indexOf(a._hideLayersInLegend,c.id)){var g=this._buildLegendItems(a,c,f);b=b||g}},this):"esri.layers.ArcGISImageServiceLayer"==a.declaredClass&&(b=this._buildLegendItems(a,{id:0,name:null,title:a.name,subLayerIds:null,parentLayerId:-1},0))}else a.renderer&&(c=a.url?a.url.substring(a.url.lastIndexOf("/")+
1,a.url.length):"fc_"+a.id,b=this._buildLegendItems(a,{id:c,name:null,subLayerIds:null,parentLayerId:-1},0));b&&(t.set(q.byId(this.id+"_"+a.id),"display","block"),t.set(q.byId(this.id+"_msg"),"display","none"))}},_legendRequest:function(a){if(a.loaded)return 10.01<=a.version?this._legendRequestServer(a):this._legendRequestTools(a);n.connect(a,"onLoad",s.hitch(this,"_legendRequest"))},_legendRequestServer:function(a){var b=a.url,c=b.indexOf("?"),b=-1<c?b.substring(0,c)+"/legend"+b.substring(c):b+"/legend";
(c=a._getToken())&&(b+="?token\x3d"+c);var d=s.hitch(this,"_processLegendResponse"),c={f:"json"};a._params.dynamicLayers&&(c.dynamicLayers=N.stringify(this._createDynamicLayers(a)),"[{}]"===c.dynamicLayers&&(c.dynamicLayers="[]"));a._params.bandIds&&(c.bandIds=a._params.bandIds);a._params.renderingRule&&(c.renderingRule=a._params.renderingRule);return I({url:b,content:c,callbackParamName:"callback",load:function(b,c){d(a,b,c)},error:H.defaults.io.errorHandler})},_legendRequestTools:function(a){var b=
a.url.toLowerCase().indexOf("/rest/"),b=a.url.substring(0,b)+a.url.substring(b+5,a.url.length),b=this._legendUrl+"?soapUrl\x3d"+window.escape(b);if(!v("ie")||8<v("ie"))b+="\x26returnbytes\x3dtrue";var c=s.hitch(this,"_processLegendResponse");return I({url:b,content:{f:"json"},callbackParamName:"callback",load:function(b,f){c(a,b,f)},error:H.defaults.io.errorHandler})},_processLegendResponse:function(a,b){b&&b.layers?(a.legendResponse=b,q.byId(this.id+"_"+a.id)&&e.empty(q.byId(this.id+"_"+a.id)),e.create("span",
{innerHTML:this._getServiceTitle(a),"class":"esriLegendServiceLabel"},e.create("td",{align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%"},q.byId(this.id+"_"+a.id)))))),this._createLegendForLayer(a)):console.log("Legend could not get generated for "+a.url+": "+L.toJson(b))},_buildLegendItems:function(a,b,c){var d=!1,f=q.byId(this.id+"_"+a.id),g=b.parentLayerId;if(b.subLayerIds)a=e.create("div",{id:this.id+"_"+a.id+"_"+b.id+"_group",style:{display:"none"},"class":-1==
g?0<c?"esriLegendGroupLayer":"":this._legendAlign},-1==g?f:q.byId(this.id+"_"+a.id+"_"+g+"_group")),e.create("td",{innerHTML:b.name,align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%","class":"esriLegendLayerLabel"},a))));else{if(a.visibleLayers&&-1==(","+a.visibleLayers+",").indexOf(","+b.id+","))return d;c=e.create("div",{id:this.id+"_"+a.id+"_"+b.id,style:{display:"none"},"class":-1<g?this._legendAlign:""},-1==g?f:q.byId(this.id+"_"+a.id+"_"+g+"_group"));e.create("td",
{innerHTML:b.name||"",align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%","class":"esriLegendLayerLabel"},c))));a.legendResponse?d=d||this._buildLegendItems_Tools(a,b,c):a.renderer&&(d=d||this._buildLegendItems_Renderer(a,b,c))}return d},_buildLegendItems_Tools:function(a,b,c){var d=b.parentLayerId,f=this.map.getScale(),g=!1,p=function(a,b){var c,d;for(c=0;c<a.length;c++)if(b.dynamicLayerInfos)for(d=0;d<b.dynamicLayerInfos[d].length;d++){if(b.dynamicLayerInfos[d].mapLayerId==
a[c].layerId)return a[c]}else if(b.id==a[c].layerId)return a[c];return{}};if(!this._respectCurrentMapScale||this._respectCurrentMapScale&&this._isLayerInScale(a,b,f)){var l=!0;if("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISMapServiceLayer"===a.declaredClass){var k=this._getEffectiveScale(a,b);if(k.minScale&&k.minScale<f||k.maxScale&&k.maxScale>f)l=!1}if(l){var f=p(a.legendResponse.layers,b),h=f.legendType,w=f.legend;if(w){c=e.create("table",{cellpadding:0,cellspacing:0,
width:"95%","class":"esriLegendLayer"},c);var r=e.create("tbody",{},c);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(c,a,b);m.forEach(w,function(c){if(!(10.1<=a.version&&!c.values&&1<w.length&&(a._hideDefaultSymbol||"\x3call other values\x3e"===c.label||!c.label&&!("esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.3<=a.version))))if(c.url&&0===c.url.indexOf("http")||c.imageData&&0<c.imageData.length)g=!0,this._buildRow_Tools(c,r,a,b.id,h)},this)}}}g&&(t.set(q.byId(this.id+"_"+
a.id+"_"+b.id),"display","block"),-1<d&&(t.set(q.byId(this.id+"_"+a.id+"_"+d+"_group"),"display","block"),this._findParentGroup(a.id,a,d)));return g},_buildRow_Tools:function(a,b,c,d,f){var g=e.create("tr",{},b),p;this.alignRight?(b=e.create("td",{align:this._isRightToLeft?"left":"right"},g),p=e.create("td",{align:this._isRightToLeft?"left":"right",width:35},g)):(p=e.create("td",{width:35},g),b=e.create("td",{},g));g=a.url;(!v("ie")||9<=v("ie")||9>v("ie")&&"esri.layers.ArcGISImageServiceLayer"===
c.declaredClass)&&a.imageData&&0<a.imageData.length?g="data:image/png;base64,"+a.imageData:0!==a.url.indexOf("http")&&(g=c.url+"/"+d+"/images/"+a.url,(d=c._getToken())&&(g+="?token\x3d"+d));d=e.create("img",{src:g,border:0,style:"opacity:"+c.opacity},p);a=e.create("td",{innerHTML:a.label,align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%",dir:"ltr"},b))));f&&("Stretched"===f&&10.3<=c.version&&"esri.layers.ArcGISImageServiceLayer"===c.declaredClass)&&(a.style.verticalAlign=
"top",a.style.lineHeight="1",d.style.marginBottom="-1px",d.style.display="block",b.style.verticalAlign="top");9>v("ie")&&(d.style.filter="alpha(opacity\x3d"+100*c.opacity+")")},_getVariable:function(a,b){return a?a[b]||m.filter(a.visualVariables,function(a){return a.type===b})[0]:null},_buildLegendItems_Renderer:function(a,b,c){var d=b.parentLayerId,f=this.map,g=f.getScale(),p=!1;if(!this._respectCurrentMapScale||this._isLayerInScale(a,b,g)){var l,k,h=a.renderer,w,r,u,n,z;if(h instanceof R&&(h=(h=
"zoom"===h.rangeType?h.getRendererInfoByZoom(f.getZoom()):h.getRendererInfoByScale(g))&&h.renderer,!h))return!1;var f=this._getVariable(h,"colorInfo"),g=this._getVariable(h,"opacityInfo"),v=this._getVariable(h,"sizeInfo");f?(w=this._getMedianColor(h,f),f.field&&(u=s.isFunction(f.field)?null:a._getField(f.field,!0))):g&&(z=s.isFunction(g.field)?null:a._getField(g.field,!0));v&&v.field&&(n=s.isFunction(v.field)?null:a._getField(v.field,!0));if(h instanceof U)p=!0,this._showHeatRamp(a,b,h,c);else if(h instanceof
S)p=!0,this._showDotDensityLegend(a,b,h,c);else if(h instanceof T)p=!0,k=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),l=e.create("tbody",{},k),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(k,a,b),h.latestObservationRenderer&&h.latestObservationRenderer instanceof B&&this._buildRow_Renderer(a,h.latestObservationRenderer.symbol,w,h.latestObservationRenderer.label||this.NLS_currentObservations,null,l),h.observationRenderer&&h.observationRenderer instanceof
B&&this._buildRow_Renderer(a,h.observationRenderer.symbol,w,h.observationRenderer.label||this.NLS_previousObservations,null,l);else if(h instanceof J){if(h.infos&&0<h.infos.length){p=!0;k=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c);l=e.create("tbody",{},k);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(k,a,b);var x=[];m.forEach(h.infos,function(b){var c=null;a._editable&&a.types&&(c=this._getTemplateFromTypes(a.types,b.value));var d=b.label;null==
d&&(d=b.value);-1===m.indexOf(x,d)&&(x.push(d),this._buildRow_Renderer(a,b.symbol,w,d,c,l))},this)}}else h instanceof E?h.infos&&0<h.infos.length&&(p=!0,k=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),l=e.create("tbody",{},k),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(k,a,b),m.forEach(h.infos,function(b){var c=b.label;null==c&&(c=b.minValue+" - "+b.maxValue);this._buildRow_Renderer(a,b.symbol,w,c,null,l)},this)):h instanceof B&&(p=!0,k=e.create("table",
{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),l=e.create("tbody",{},k),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(k,a,b),r=null,a._editable&&(a.templates&&0<a.templates.length)&&(r=a.templates[0]),k=(u||z)&&n?null:u||z||n,this._buildRow_Renderer(a,h.symbol,w,k?k.alias||k.name:h.label,r,l),r=h.symbol&&h.symbol.color,k&&(u=z=n=null));p&&(f&&f.field?(u&&this._isSmartRenderer(h,u.name)&&(u=null),this._showColorRamp(a,b,h,null,c,f,u)):g&&r&&this._showColorRamp(a,
b,h,r,c,g,z),v&&v.field&&(n&&this._isSmartRenderer(h,n.name)&&(n=null),this._showSizeLegend(a,b,h,v,w,c,n)));!a._hideDefaultSymbol&&h.defaultSymbol&&(p=!0,k=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},c),l=e.create("tbody",{},k),this._buildRow_Renderer(a,h.defaultSymbol,null,h.defaultLabel||"others",null,l))}p&&(t.set(q.byId(this.id+"_"+a.id+"_"+b.id),"display","block"),-1<d&&(t.set(q.byId(this.id+"_"+a.id+"_"+d+"_group"),"display","block"),this._findParentGroup(a.id,
d)));return p},_isSmartRenderer:function(a,b){return a instanceof E&&a.infos&&1===a.infos.length&&a.attributeField===b},_showColorRamp:function(a,b,c,d,f,g,p){var l;l=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},f);f=e.create("tbody",{},l);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(l,a,b);p&&this._addSubHeader(f,p.alias||p.name);b=this._getRampStops(c,g,d);b.length&&this._drawColorRamp(f,b,a)},_getMedianColor:function(a,b){var c,d;b.colors?(c=
b.minDataValue,d=b.maxDataValue):b.stops&&(c=b.stops[0].value,d=b.stops[b.stops.length-1].value);return a.getColor(c+(d-c)/2,{colorInfo:b})},_getRampStops:function(a,b,c){var d,f,g,p,e=!1;b.colors||b.opacityValues?(f=b.maxDataValue-b.minDataValue,d=m.map([0,0.25,0.5,0.75,1],function(a){g=b.minDataValue+a*f;return Number(g.toFixed(6))}),this._checkPrecision(0,4,d)):b.stops&&(d=m.map(b.stops,function(a){return a.value}),(e=m.some(b.stops,function(a){return!!a.label}))&&(p=m.map(b.stops,function(a){return a.label})));
var k=d[0],h,n,r;f=d[d.length-1]-k;return m.map(d,function(g,m){c?(h=new y(c.toRgba()),n=a.getOpacity(g,{opacityInfo:b}),null!=n&&(h.a=n)):h=a.getColor(g,{colorInfo:b});r="";0===m?r="\u2264 ":m===d.length-1&&(r="\u2265 ");return{value:g,color:h,offset:1-(g-k)/f,label:e?p[m]:r+F.format(g,{places:20,round:-1}).replace(this.reZerosFractional,"$1").replace(this.reZeros,"")}},this).reverse()},_checkPrecision:function(a,b,c){var d=a+(b-a)/2,f=c[a],g=c[d],p=c[b],e=Math.floor(f),k=Math.floor(g),h=Math.floor(p);
e===f&&(h===p&&k!==g&&e!==k&&h!==k)&&(c[d]=k);a+1!==d&&this._checkPrecision(a,d,c);d+1!==b&&this._checkPrecision(d,b,c)},_drawColorRamp:function(a,b,c){var d=e.create("tr",{},a),f,g,p,l,k,h,n;this.alignRight?(a=e.create("td",{align:this._isRightToLeft?"left":"right"},d),f=e.create("td",{align:this._isRightToLeft?"left":"right",width:34},d)):(f=e.create("td",{width:34,align:"center"},d),a=e.create("td",{},d));g=e.create("div",{style:"position: relative; width:34px;"},f);p=e.create("div",{"class":"esriLegendColorRamp"},
g);d=t.get(p,"width");f=t.get(p,"height");t.set(g,"height",f+"px");p=G.createSurface(p,d,f);9>v("ie")&&(k=p.getEventSource(),t.set(k,"position","relative"),t.set(k.parentNode,"position","relative"));try{h=p.createRect({width:d,height:f}),h.setFill({type:"linear",x1:0,y1:0,x2:0,y2:f,colors:b}).setStroke(null),p.createRect({width:d,height:f}).setFill(new y([255,255,255,1-c.opacity])).setStroke(null),this._surfaceItems.push(p)}catch(r){p.clear(),p.destroy()}l=e.create("div",{"class":"esriLegendColorRampLabels"},
a);m.forEach(b,function(a,c){a.label&&(n="top:"+100*a.offset+"%;",e.create("div",{"class":"esriLegendColorRampTick"+(c===b.length-1?" esriLegendColorRampTickLast":""),innerHTML:"\x26nbsp;",style:n},g),e.create("div",{"class":"esriLegendColorRampLabel",innerHTML:a.label,style:n},l))})},_showHeatRamp:function(a,b,c,d){var f,g=c.field;f=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);d=e.create("tbody",{},f);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(f,
a,b);(g=g&&a.getField(g))&&this._addSubHeader(d,g.alias||g.name);b=this._getHeatmapStops(c);b.length&&this._drawColorRamp(d,b,a)},_getHeatmapStops:function(a){var b=a.colorStops;a=a.colors;var c,d,f,g;if(b&&b[0])if(c=b.length-1,a=b[0]&&null!=b[0].ratio){if((a=b[c])&&1!==a.ratio)b=b.slice(0),b.push({ratio:1,color:a.color}),c++}else d=b[0].value,f=b[c].value-d,b=m.map(b,function(a){return{color:a.color,ratio:(a.value-d)/f}});else a&&a[0]&&(c=a.length-1,g=1/(a.length-1),b=m.map(a,function(a,b){return{color:a,
ratio:b*g}}));b=m.map(b,function(a,b){var d="";0===b?d="Low":b===c&&(d="High");return{color:a.color,label:d,offset:1-a.ratio}});return b.reverse()},_showDotDensityLegend:function(a,b,c,d){var f=c.legendOptions,g,p,l,k,h,n,r,u=this.dotDensitySwatchSize,q=Math.round(u/2);f&&(p=f.backgroundColor,l=f.outline,k=f.valueUnit,h=f.dotCoverage);h=(h||this.dotCoverage)/100;r=Math.round(u*u/Math.pow(c.dotSize,2)*h);d=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},d);n=e.create("tbody",
{},d);(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(d,a,b);this._addSubHeader(n,D.substitute({value:c.dotValue,unit:k||""},this.NLS_dotValue));m.forEach(c.fields,function(b){b=s.mixin({},b);b.numPoints=r;g=new W(c._generateImageSrc(u,u,[b],{x:0,y:0},{x:u,y:u},p),l||c.outline,u,u);b=a._getField(b.name,!0)||b;this._buildRow_Renderer(a,g,null,b.alias||b.name,null,n,{type:"path",path:"M "+-q+","+-q+" L "+q+","+-q+" L "+q+","+q+" L "+-q+","+q+" L "+-q+","+-q+" E"})},this)},_showSizeLegend:function(a,
b,c,d,f,g,p){var l=d.legendOptions,l=l&&l.customValues,k,h=d.minDataValue,n=d.maxDataValue,r=this._getSizeSymbol(c,f);"unknown"!==d.valueUnit||(!r||!l&&(null==h||null==n))||(f=e.create("table",{cellpadding:0,cellspacing:0,width:"95%","class":"esriLegendLayer"},g),k=e.create("tbody",{},f),(a._hoverLabel||a._hoverLabels)&&this._createHoverAction(f,a,b),p&&this._addSubHeader(k,p.alias||p.name),b=l||this._getDataValues(h,n),m.forEach(b,function(b){r=C.fromJson(r.toJson());this._applySize(r,c,d,b);b=F.format(b,
{places:20,round:-1}).replace(this.reZerosFractional,"$1").replace(this.reZeros,"");this._buildRow_Renderer(a,r,null,b,null,k)},this))},_getSizeSymbol:function(a,b){var c,d;if(a instanceof B)d=!0,c=a.symbol;else if(a instanceof J||a instanceof E)c=a.infos[0].symbol;if(c=-1!==c.type.indexOf("fillsymbol")?null:c)!d&&"picturemarkersymbol"===c.type?(c=new V,c.setStyle("square"),c.outline.setWidth(1)):c=C.fromJson(c.toJson()),b?c.setColor(new y(b.toRgba())):d||c.setColor(new y([127,127,127]));return c},
_applySize:function(a,b,c,d){var f=a.type;c={sizeInfo:c,shape:-1!==f.indexOf("markersymbol")?a.style:null};b=b.getSize(d,c);switch(f){case "simplemarkersymbol":a.setSize(b);break;case "picturemarkersymbol":a.setWidth(b);a.setHeight(b);break;case "simplelinesymbol":case "cartographiclinesymbol":a.setWidth(b)}},_getDataValues:function(a,b){var c=[a,b],d=Math.LN10,f=Math.log(a),g=Math.log(b),e,l,k,h,n;m.forEach([1,2.5,5],function(a){h=Math.log(a);e=Math.ceil((f-h)/d);l=Math.floor((g-h)/d);if(!(Infinity===
Math.abs(e)||Infinity===Math.abs(l)))for(k=e;k<l+1;k++)n=a*Math.pow(10,k),-1===m.indexOf(c,n)&&c.push(n)});c.sort(this._sorter);return c.reverse()},_sorter:function(a,b){return a-b},_buildRow_Renderer:function(a,b,c,d,f,g,p){var l=e.create("tr",{},g),k;this.alignRight?(g=e.create("td",{align:this._isRightToLeft?"left":"right"},l),k=e.create("td",{align:this._isRightToLeft?"left":"right",width:35},l)):(k=e.create("td",{width:35,align:"center"},l),g=e.create("td",{},l));var h=l=30;"simplemarkersymbol"==
b.type?(l=Math.min(Math.max(l,b.size+12),125),h=Math.min(Math.max(h,b.size+12),125)):"picturemarkersymbol"==b.type&&(l=Math.min(Math.max(l,b.width),125),h=Math.min(b.height||h,125));k=e.create("div",{style:"width:"+l+"px;height:"+h+"px;"},k);D.isDefined(d)&&"number"===typeof d&&(d=""+d);e.create("td",{innerHTML:d||"",align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%"},g))));a=this._drawSymbol(k,b,c,l,h,f,a,p);this._surfaceItems.push(a)},_addSubHeader:function(a,
b){var c=e.create("tr",{},a),c=e.create("td",{align:this._align,colspan:2},c);e.create("td",{innerHTML:b||"",align:this._align},e.create("tr",{},e.create("tbody",{},e.create("table",{width:"95%"},c))))},_drawSymbol:function(a,b,c,d,f,g,e,l){b=C.fromJson(b.toJson());var k=e.opacity;c&&b.setColor(new y(c.toRgba()));if("simplelinesymbol"===b.type||"cartographiclinesymbol"===b.type||"textsymbol"===b.type){if(!b.color)return;c=b.color.toRgba();c[3]*=k;b.color.setColor(c)}else if("simplemarkersymbol"===
b.type||"simplefillsymbol"===b.type){if(!b.color)return;c=b.color.toRgba();c[3]*=k;b.color.setColor(c);b.outline&&b.outline.color&&(c=b.outline.color.toRgba(),c[3]*=k,b.outline.color.setColor(c))}else"picturemarkersymbol"===b.type&&(a.style.opacity=k,a.style.filter="alpha(opacity\x3d("+100*k+"))");a=G.createSurface(a,d,f);9>v("ie")&&(c=a.getEventSource(),t.set(c,"position","relative"),t.set(c.parentNode,"position","relative"));g=this._getDrawingToolShape(b,g)||C.getShapeDescriptors(b);var h;try{h=
a.createShape(l||g.defaultShape).setFill(g.fill).setStroke(g.stroke)}catch(n){a.clear();a.destroy();return}var m=h.getBoundingBox();l=m.width;g=m.height;var k=-(m.x+l/2),q=-(m.y+g/2);c=a.getDimensions();k={dx:k+c.width/2,dy:q+c.height/2};if("simplemarkersymbol"===b.type&&"path"===b.style)d=e._getScaleMatrix(m,b.size),h.applyTransform(P.scaleAt(d.xx,d.yy,{x:c.width/2,y:c.height/2}));else if(l>d||g>f)e=l/d>g/f,d=((e?d:f)-5)/(e?l:g),s.mixin(k,{xx:d,yy:d});h.applyTransform(k);return a},_getDrawingToolShape:function(a,
b){var c;switch(b?b.drawingTool||null:null){case "esriFeatureEditToolArrow":c={type:"path",path:"M 10,1 L 3,8 L 3,5 L -15,5 L -15,-2 L 3,-2 L 3,-5 L 10,1 E"};break;case "esriFeatureEditToolTriangle":c={type:"path",path:"M -10,14 L 2,-10 L 14,14 L -10,14 E"};break;case "esriFeatureEditToolRectangle":c={type:"path",path:"M -10,-10 L 10,-10 L 10,10 L -10,10 L -10,-10 E"};break;case "esriFeatureEditToolCircle":c={type:"circle",cx:0,cy:0,r:10};break;case "esriFeatureEditToolEllipse":c={type:"ellipse",
cx:0,cy:0,rx:10,ry:5};break;default:return null}return{defaultShape:c,fill:a.getFill(),stroke:a.getStroke()}},_repaintItems:function(){m.forEach(this._surfaceItems,function(a){this._repaint(a)},this)},_repaint:function(a){if(a){a.getStroke&&a.setStroke&&a.setStroke(a.getStroke());try{a.getFill&&a.setFill&&a.setFill(a.getFill())}catch(b){}a.children&&s.isArray(a.children)&&m.forEach(a.children,this._repaint,this)}},_createHoverAction:function(a,b,c){var d=b._hoverLabel||b._hoverLabels[c.id];d&&(b.mouseMoveHandler=
b.mouseMoveHandler||{},b.mouseMoveHandler[c.id]=n.connect(a,"onmousemove",s.hitch(this,function(a,b){this.mouseX=b.clientX;this.mouseY=b.clientY;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,t.set(q.byId(this.id+"_hoverLabel"),"display","none"));setTimeout(s.hitch(this,function(a,b,c){if(a==this.mouseX&&b==this.mouseY&&!this.hoverLabelShowing)if(this.hoverLabelShowing=!0,q.byId(this.id+"_hoverLabel")){var d=q.byId(this.id+"_hoverLabel");d.innerHTML="\x3cspan\x3e"+c+"\x3c/span\x3e";t.set(d,"top",
b+"px");t.set(d,"left",a+15+"px");t.set(d,"display","")}else e.create("div",{innerHTML:"\x3cspan\x3e"+c+"\x3c/span\x3e",id:this.id+"_hoverLabel","class":"esriLegendHoverLabel",style:{top:b+"px",left:a+15+"px"}},document.body)},b.clientX,b.clientY,a),500)},d)),b.mouseOutHandler=b.mouseOutHandler||{},b.mouseOutHandler[c.id]=n.connect(a,"onmouseout",s.hitch(this,function(a){this.mouseY=this.mouseX=-1;this.hoverLabelShowing&&(this.hoverLabelShowing=!1,t.set(q.byId(this.id+"_hoverLabel"),"display","none"))})))},
_removeHoverHandlers:function(){var a;m.forEach(this.layers,function(b){if(b.mouseMoveHandler)for(a in b.mouseMoveHandler)n.disconnect(b.mouseMoveHandler[a]);if(b.mouseOutHandler)for(a in b.mouseOutHandler)n.disconnect(b.mouseOutHandler[a])})},_createDynamicLayers:function(a){var b=[],c;m.forEach(a.dynamicLayerInfos||a.layerInfos,function(d){c={id:d.id};c.source=d.source&&d.source.toJson();var f;a.layerDefinitions&&a.layerDefinitions[d.id]&&(f=a.layerDefinitions[d.id]);f&&(c.definitionExpression=
f);var g;a.layerDrawingOptions&&a.layerDrawingOptions[d.id]&&(g=a.layerDrawingOptions[d.id]);g&&(c.drawingInfo=g.toJson());c.minScale=d.minScale||0;c.maxScale=d.maxScale||0;b.push(c)});return b},_getTemplateFromTypes:function(a,b){var c;for(c=0;c<a.length;c++)if(a[c].id==b&&a[c].templates&&0<a[c].templates.length)return a[c].templates[0];return null},_findParentGroup:function(a,b,c){var d,f=b.dynamicLayerInfos||b.layerInfos;for(d=0;d<f.length;d++)if(c==f[d].id){-1<f[d].parentLayerId&&(t.set(q.byId(this.id+
"_"+a+"_"+f[d].parentLayerId+"_group"),"display","block"),this._findParentGroup(a,b,f[d].parentLayerId));break}},_addSubLayersToHide:function(a){function b(c,d){var f=a.layer.dynamicLayerInfos||a.layer.layerInfos,g,e;for(g=0;g<f.length;g++)if(f[g].id===c&&f[g].subLayerIds)for(e=0;e<f[g].subLayerIds.length;e++){var l=f[g].subLayerIds[e];-1===m.indexOf(d,l)&&(d.push(l),b(l,d))}}a.layer.layerInfos&&m.forEach(a.layer._hideLayersInLegend,function(c){b(c,a.layer._hideLayersInLegend)})},_isLayerInScale:function(a,
b,c){var d,f=!0;if(a.legendResponse&&a.legendResponse.layers)for(d=0;d<a.legendResponse.layers.length;d++){var g=a.legendResponse.layers[d];if(b.id==g.layerId){var e,l;!a.minScale&&0!==a.minScale||!a.maxScale&&0!==a.maxScale?(0==g.minScale&&a.tileInfo&&(e=a.tileInfo.lods[0].scale),0==g.maxScale&&a.tileInfo&&(l=a.tileInfo.lods[a.tileInfo.lods.length-1].scale)):(e=Math.min(a.minScale,g.minScale)||a.minScale||g.minScale,l=Math.max(a.maxScale,g.maxScale));if(0<e&&e<c||l>c)f=!1;break}}else if(a.minScale||
a.maxScale)if(a.minScale&&a.minScale<c||a.maxScale&&a.maxScale>c)f=!1;return f},_getServiceTitle:function(a){var b=a._titleForLegend;b||((b=a.url)?-1<a.url.indexOf("/MapServer")?(b=a.url.substring(0,a.url.indexOf("/MapServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/ImageServer")?(b=a.url.substring(0,a.url.indexOf("/ImageServer")),b=b.substring(b.lastIndexOf("/")+1,b.length)):-1<a.url.indexOf("/FeatureServer")&&(b=a.url.substring(0,a.url.indexOf("/FeatureServer")),b=b.substring(b.lastIndexOf("/")+
1,b.length)):b="",a.name&&(b=0<b.length?b+(" - "+a.name):a.name));return Q.encode(b)},_getEffectiveScale:function(a,b){var c=b.minScale,d=b.maxScale;if(D.isDefined(b.parentLayerId)){var f=a.layerInfos,g=b.parentLayerId,e;for(e=f.length-1;0<=e;e--)if(f[e].id==g)if(0==c&&0<f[e].minScale?c=f[e].minScale:0<c&&0==f[e].minScale||0<c&&0<f[e].minScale&&(c=Math.min(c,f[e].minScale)),d=Math.max(d||0,f[e].maxScale||0),-1<f[e].parentLayerId)g=f[e].parentLayerId;else break}return{minScale:c,maxScale:d}},_isSupportedLayerType:function(a){return a&&
("esri.layers.ArcGISDynamicMapServiceLayer"===a.declaredClass||"esri.layers.ArcGISImageServiceLayer"===a.declaredClass&&10.2<=a.version||"esri.layers.ArcGISTiledMapServiceLayer"===a.declaredClass||"esri.layers.FeatureLayer"===a.declaredClass||"esri.layers.StreamLayer"===a.declaredClass||"esri.layers.KMLLayer"===a.declaredClass||"esri.layers.GeoRSSLayer"===a.declaredClass||"esri.layers.WMSLayer"===a.declaredClass||"esri.layers.CSVLayer"===a.declaredClass)?!0:!1}});s.mixin(x,{ALIGN_LEFT:0,ALIGN_RIGHT:1});
return x});},
// Source: lib/esri/layers/ArcGISImageServiceLayer.js
'esri/layers/ArcGISImageServiceLayer': function() {
//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/Deferred","dojo/_base/array","dojo/_base/json","dojo/_base/config","dojo/has","dojo/io-query","../kernel","../config","../lang","../request","../deferredUtils","../urlUtils","../geometry/Extent","../geometry/Point","../SpatialReference","./MosaicRule","./DynamicMapServiceLayer","./TimeInfo","./Field","../graphic","../tasks/ImageServiceIdentifyTask","../tasks/ImageServiceIdentifyParameters","../geometry/Polygon"],function(I,e,A,x,B,F,S,J,T,G,C,s,m,E,H,K,U,D,L,M,N,O,P,Q,R){return I(L,
{declaredClass:"esri.layers.ArcGISImageServiceLayer",_eventMap:{"rendering-change":!0,"mosaic-rule-change":!0},constructor:function(a,c){this._url=E.urlToObject(a);var b=c&&c.imageServiceParameters;this.format=b&&b.format;this.interpolation=b?b.interpolation:null;this.compressionQuality=b?b.compressionQuality:null;this.bandIds=b?b.bandIds:null;this.mosaicRule=b?b.mosaicRule:null;this.renderingRule=b?b.renderingRule:null;this._params=e.mixin({},this._url.query,{f:"image",interpolation:this.interpolation,
format:this.format,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null},b?b.toJson():{});this._initLayer=e.hitch(this,this._initLayer);this._queryVisibleRastersHandler=e.hitch(this,this._queryVisibleRastersHandler);this._visibleRasters=[];this.useMapImage=c&&c.useMapImage||!1;this.infoTemplate=c&&c.infoTemplate;this._rasterAttributeTableFields=[];this._rasterAttributeTableFeatures=[];this._loadCallback=c&&c.loadCallback;(b=c&&c.resourceInfo)?this._initLayer(b):
s({url:this._url.path,content:e.mixin({f:"json"},this._url.query),callbackParamName:"callback",load:this._initLayer,error:this._errorHandler});this.registerConnectEvents()},disableClientCaching:!1,_initLayer:function(a,c){this._findCredential();(this.credential&&this.credential.ssl||a&&a._ssl)&&this._useSSL();var b=this.minScale,d=this.maxScale;e.mixin(this,a);this.minScale=b;this.maxScale=d;this.initialExtent=this.fullExtent=this.extent=new H(a.extent);this.spatialReference=this.initialExtent.spatialReference;
this.pixelSizeX=parseFloat(this.pixelSizeX);this.pixelSizeY=parseFloat(this.pixelSizeY);for(var h=this.minValues,n=this.maxValues,f=this.meanValues,q=this.stdvValues,k=this.bands=[],b=0,d=this.bandCount;b<d;b++)k[b]={min:h[b],max:n[b],mean:f[b],stddev:q[b]};this.timeInfo=(b=this.timeInfo)&&b.timeExtent?new M(b):null;d=this.fields=[];if(h=a.fields)for(b=0;b<h.length;b++)d.push(new N(h[b]));this.version=a.currentVersion;this.version||(this.version="fields"in a||"objectIdField"in a||"timeInfo"in a?10:
9.3);C.isDefined(a.minScale)&&!this._hasMin&&this.setMinScale(a.minScale);C.isDefined(a.maxScale)&&!this._hasMax&&this.setMaxScale(a.maxScale);b={};a.defaultMosaicMethod?(b.method=a.defaultMosaicMethod,b.operation=a.mosaicOperator,b.sortField=a.sortField,b.sortValue=a.sortValue):b.method=D.METHOD_NONE;this.defaultMosaicRule=new D(b);this.defaultMosaicRule.ascending=!0;10<this.version&&this.hasRasterAttributeTable&&this.getRasterAttributeTable().then(e.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&
(this._rasterAttributeTableFeatures=e.clone(a.features));a&&(a.fields&&0<a.fields.length)&&(this._rasterAttributeTableFields=e.clone(a.fields))}));this.loaded=!0;this.onLoad(this);if(b=this._loadCallback)delete this._loadCallback,b(this)},getKeyProperties:function(){var a=this._url.path+"/keyProperties",c=new A(m._dfdCanceller);10<this.version?(c._pendingDfd=s({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),c._pendingDfd.then(function(a){c.callback(a)},function(a){c.errback(a)})):
(a=Error("Layer does not have key properties"),a.log=F.isDebug,c.errback(a));return c},getRasterAttributeTable:function(){var a=this._url.path+"/rasterAttributeTable",c=new A(m._dfdCanceller);10<this.version&&this.hasRasterAttributeTable?(c._pendingDfd=s({url:a,content:{f:"json"},handleAs:"json",callbackParamName:"callback"}),c._pendingDfd.then(function(a){c.callback(a)},function(a){c.errback(a)})):(a=Error("Layer does not support raster attribute table"),a.log=F.isDebug,c.errback(a));return c},_getRasterAttributeTableFeatures:function(){var a=
new A;if(this._rasterAttributeTableFeatures&&0<this._rasterAttributeTableFeatures.length)return a.resolve(this._rasterAttributeTableFeatures),a;if(10<this.version&&this.hasRasterAttributeTable)return a=this.getRasterAttributeTable(),a.then(e.hitch(this,function(a){a&&(a.features&&0<a.features.length)&&(this._rasterAttributeTableFeatures=e.clone(a.features))})),a;a.resolve(this._rasterAttributeTableFeatures);return a},getCustomRasterFields:function(a){var c=a?a.rasterAttributeTableFieldPrefix:"",b=
{name:"Raster.ItemPixelValue",alias:"Item Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};a=this.fields?e.clone(this.fields):[];var d=a.length;a[d]={name:"Raster.ServicePixelValue",alias:"Service Pixel Value",domain:null,editable:!1,length:50,type:"esriFieldTypeString"};if(this.capabilities&&-1<this.capabilities.toLowerCase().indexOf("catalog")||this.fields&&0<this.fields.length)a[d+1]=b;this._rasterAttributeTableFields&&0<this._rasterAttributeTableFields.length&&(b=x.filter(this._rasterAttributeTableFields,
function(a){return"esriFieldTypeOID"!==a.type&&"value"!==a.name.toLowerCase()}),b=x.map(b,function(a){var b=e.clone(a);b.name=c+a.name;return b}),a=a.concat(b));return a},getImageUrl:function(a,c,b,d){var h=a.spatialReference.wkid||B.toJson(a.spatialReference.toJson());delete this._params._ts;var n=this._url.path+"/exportImage?";e.mixin(this._params,{bbox:a.xmin+","+a.ymin+","+a.xmax+","+a.ymax,imageSR:h,bboxSR:h,size:c+","+b},this.disableClientCaching?{_ts:(new Date).getTime()}:{});var f=this._params.token=
this._getToken();a=E.addProxy(n+J.objectToQuery(e.mixin(this._params,{f:"image"})));a.length>G.defaults.io.postLength||this.useMapImage?this._jsonRequest=s({url:n,content:e.mixin(this._params,{f:"json"}),callbackParamName:"callback",load:function(a,b){var c=a.href;f&&(c+=-1===c.indexOf("?")?"?token\x3d"+f:"\x26token\x3d"+f);d(E.addProxy(c))},error:this._errorHandler}):d(a)},onRenderingChange:function(){},onMosaicRuleChange:function(){},setInterpolation:function(a,c){this.interpolation=this._params.interpolation=
a;c||this.refresh(!0)},setCompressionQuality:function(a,c){this.compressionQuality=this._params.compressionQuality=a;c||this.refresh(!0)},setBandIds:function(a,c){var b=!1;this.bandIds!==a&&(b=!0);this.bandIds=a;this._params.bandIds=a.join(",");if(b&&!c)this.onRenderingChange();c||this.refresh(!0)},setDefaultBandIds:function(a){this.bandIds=this._params.bandIds=null;a||this.refresh(!0)},setDisableClientCaching:function(a){this.disableClientCaching=a},setMosaicRule:function(a,c){var b=!1;this.mosaicRule!==
a&&(b=!0);this.mosaicRule=a;this._params.mosaicRule=B.toJson(a.toJson());if(b&&!c)this.onMosaicRuleChange();c||this.refresh(!0)},setRenderingRule:function(a,c){var b=!1;this.renderingRule!==a&&(b=!0);this.renderingRule=a;this._params.renderingRule=a?B.toJson(a.toJson()):null;if(b&&!c)this.onRenderingChange();c||this.refresh(!0)},setImageFormat:function(a,c){this.format=this._params.format=a;c||this.refresh(!0)},setInfoTemplate:function(a){this.infoTemplate=a},setDefinitionExpression:function(a,c){var b=
this.mosaicRule?this.mosaicRule.toJson():{};this.mosaicRule||(this.defaultMosaicRule?b=this.defaultMosaicRule.toJson():b.method=D.METHOD_NONE);b.where=a;b=new D(b);this.setMosaicRule(b,c);return this},getDefinitionExpression:function(){return this.mosaicRule?this.mosaicRule.where:null},refresh:function(a){if(a)this.inherited(arguments);else{var c=this.disableClientCaching;this.disableClientCaching=!0;this.inherited(arguments);this.disableClientCaching=c}},exportMapImage:function(a,c){var b=G.defaults.map,
b=e.mixin({size:b.width+","+b.height},this._params,a?a.toJson(this.normalization):{},{f:"json"});delete b._ts;this._exportMapImage(this._url.path+"/exportImage",b,c)},queryVisibleRasters:function(a,c,b,d){var h=this._map,e=m._fixDfd(new A(m._dfdCanceller));this._visibleRasters=[];var f,q,k=!0,g;if(this.infoTemplate&&this.infoTemplate.info.fieldInfos&&0<this.infoTemplate.info.fieldInfos.length){k=!1;g=this.infoTemplate.info;for(f=0;f<g.fieldInfos.length;f++)if((q=g.fieldInfos[f])&&"raster.servicepixelvalue"!==
q.fieldName.toLowerCase()&&(q.visible||g.title&&-1<g.title.toLowerCase().indexOf(q.fieldName.toLowerCase()))){k=!0;break}}f=new Q;f.geometry=a.geometry;f.returnGeometry=this._map.spatialReference.equals(this.spatialReference);f.returnCatalogItems=k;f.timeExtent=a.timeExtent;f.mosaicRule=this.mosaicRule?this.mosaicRule:null;f.renderingRule=this.renderingRule?this.renderingRule:null;h&&(a=new K((h.extent.xmax-h.extent.xmin)/(2*h.width),(h.extent.ymax-h.extent.ymin)/(2*h.height),h.extent.spatialReference),
f.pixelSize=a);var l=this;a=new P(this.url);(e._pendingDfd=a.execute(f)).addCallbacks(function(a){l._queryVisibleRastersHandler(a,c,b,d,e)},function(a){l._resolve([a],null,d,e,!0)});return e},_queryVisibleRastersHandler:function(a,c,b,d,h){function n(){var a=this.getCustomRasterFields(c),d=this._getDomainFields(a),g=c?c.returnDomainValues:!1,m=c&&c.rasterAttributeTableFieldPrefix,l,n,u,s,w,r,v,t;this._getRasterAttributeTableFeatures().then(e.hitch(this,function(a){for(l=0;l<k.length;l++){p=k[l];p.setInfoTemplate(this.infoTemplate);
p._layer=this;if(f&&(n=f,q&&q.length>=l&&(u=q[l],n=u.replace(/ /gi,", ")),p.attributes["Raster.ItemPixelValue"]=n,p.attributes["Raster.ServicePixelValue"]=f,a&&0<a.length&&(s=x.filter(a,function(a){if(a&&a.attributes)return a.attributes.hasOwnProperty("Value")?a.attributes.Value==n:a.attributes.VALUE==n}),0<s.length&&(w=e.clone(s[0]),m&&w)))){t={};for(r in w.attributes)w.attributes.hasOwnProperty(r)&&(v=m+r,t[v]=w.attributes[r]);w.attributes=t;p.attributes=e.mixin(p.attributes,w.attributes)}g&&(d&&
0<d.length)&&x.forEach(d,function(a){if(a){var b=p.attributes[a.name];C.isDefined(b)&&(b=this._getDomainValue(a.domain,b),C.isDefined(b)&&(p.attributes[a.name]=b))}},this);y.push(p);this._visibleRasters.push(p)}this._resolve([y,null,!0],null,b,h)}))}var f=a.value,q,k,g=0,l=0,m=this,r=this.objectIdField,v;if(a.catalogItems){d=0;var t,z,u=a.catalogItems.features.length;t=0;k=Array(u);q=Array(u);v=Array(u);for(g=0;g<u;g++)-1<a.properties.Values[g].toLowerCase().indexOf("nodata")&&t++;t=u-t;for(g=0;g<
u;g++)z=-1<a.properties.Values[g].toLowerCase().indexOf("nodata")?t++:d++,k[z]=a.catalogItems.features[g],q[z]=a.properties.Values[g],v[z]=k[z].attributes[r]}this._visibleRasters=[];var p;a=-1<f.toLowerCase().indexOf("nodata");f&&(!k&&!a)&&(r="ObjectId",k=[],p=new O(new H(this.fullExtent),null,{ObjectId:0}),k.push(p));var y=[];k?!this._map.spatialReference.equals(this.spatialReference)&&v&&0<v.length?s({url:this._url.path+"/query",content:{f:"json",objectIds:v.join(","),returnGeometry:!0,outSR:B.toJson(m._map.spatialReference.toJson()),
outFields:r},handleAs:"json",callbackParamName:"callback",load:function(a){if(0===a.features.length)m._resolve([y,null,null],null,b,h);else{for(g=0;g<a.features.length;g++)for(l=0;l<k.length;l++)k[l].attributes[r]==a.features[g].attributes[r]&&(k[l].geometry=new R(a.features[g].geometry),k[l].geometry.setSpatialReference(m._map.spatialReference));n.call(m)}},error:function(a){m._resolve([y,null,null],null,b,h)}}):n.call(this):this._resolve([y,null,null],null,b,h)},getVisibleRasters:function(){var a=
this._visibleRasters,c=[],b;for(b in a)a.hasOwnProperty(b)&&c.push(a[b]);return c},_getDomainFields:function(a){if(a){var c=[];x.forEach(a,function(a){if(a.domain){var d={};d.name=a.name;d.domain=a.domain;c.push(d)}});return c}},_getDomainValue:function(a,c){if(a&&a.codedValues){var b;x.some(a.codedValues,function(a){return a.code===c?(b=a.name,!0):!1});return b}},_resolve:function(a,c,b,d,e){c&&this[c].apply(this,a);b&&b.apply(null,a);d&&m._resDfd(d,a,e)}})});},
// Source: lib/esri/dijit/BasemapGallery.js
'esri/dijit/BasemapGallery': function() {
//>>built
define(["require","dojo/_base/declare","dojo/_base/array","dojo/_base/connect","dojo/_base/lang","dojo/_base/kernel","dojo/_base/sniff","dojo/has","dojo/query","dojo/DeferredList","dojo/dom","dojo/dom-construct","dojo/dom-class","dijit/_Widget","dijit/_Templated","../kernel","../urlUtils","../request","../geometry/Extent","../virtualearth/VETiledLayer","../layers/OpenStreetMapLayer","../layers/ArcGISTiledMapServiceLayer","../layers/ArcGISDynamicMapServiceLayer","../layers/WebTiledLayer","../layers/ArcGISImageServiceLayer","../layers/ImageServiceParameters","./Basemap","./_EventedWidget","dojo/text!./templates/BasemapGallery.html"],function(t,
u,e,n,f,p,H,I,J,v,w,g,q,x,y,l,z,h,m,k,A,B,C,D,r,s,E,F,G){return u([F,x,y],{declaredClass:"esri.dijit.BasemapGallery",widgetsInTemplate:!0,templateString:G,basePath:t.toUrl(".")+"/",loaded:!1,basemaps:[],bingMapsKey:null,flowContainer:null,_hasUI:!1,_selectedBasemap:null,_selectBasemapInProgress:!1,_eventMap:{load:!0,"selection-change":!0,add:["basemap"],remove:["basemap"],error:["message"]},constructor:function(a,b){a=a||{};a.map||console.error("esri.dijit.BasemapGallery: Unable to find the 'map' property in parameters");
this.map=a.map;this._hasUI=b?!0:!1;this.bingMapsKey=a.bingMapsKey&&0<a.bingMapsKey.length?a.bingMapsKey:null;this.showArcGISBasemaps=!1===a.showArcGISBasemaps?!1:!0;this.basemaps=a.basemaps||[];this.basemapIds=a.basemapIds;this.referenceIds=a.referenceIds;this.basemapsGroup=a.basemapsGroup;this.arcgisUrl=l.dijit._arcgisUrl;a.portalUrl&&(this.arcgisUrl=a.portalUrl+"/sharing/rest");0>this.arcgisUrl.indexOf("://")?this.arcgisUrl=window.location.protocol+"//"+this.arcgisUrl:"https:"===window.location.protocol&&
(this.arcgisUrl=this.arcgisUrl.replace("http:","https:"));this.init()},init:function(){this.inherited(arguments);e.forEach(this.basemaps,function(a,b){if(!a.id||0===a.id.length)a.id=this._getUniqueId();e.forEach(a.layers,function(a){a.opacity=0<=a.opacity?a.opacity:1;a.visibility=!0},this)},this);this.basemapIds&&0<this.basemapIds.length&&e.forEach(this.basemapIds,function(a){this.map.getLayer(a)._basemapGalleryLayerType="basemap"},this);this.referenceIds&&0<this.referenceIds.length&&e.forEach(this.referenceIds,
function(a){this.map.getLayer(a)._basemapGalleryLayerType="reference"},this);this.basemapsGroup&&(this.basemapsGroup.owner&&this.basemapsGroup.title||this.basemapsGroup.id)?this._findCustomBasemapsGroup(f.hitch(this,"_handleArcGISBasemapsResponse")):this.showArcGISBasemaps?this._findArcGISBasemapsGroup(f.hitch(this,"_handleArcGISBasemapsResponse")):this._finishStartup()},startup:function(){this.loaded?this._refreshUI():n.connect(this,"onLoad",f.hitch(this,function(){this._refreshUI()}))},select:function(a){this._select(a)},
getSelected:function(){return this._selectedBasemap},get:function(a){var b;for(b=0;b<this.basemaps.length;b++)if(this.basemaps[b].id==a)return this.basemaps[b];return null},add:function(a){return a&&!a.id?(a.id=this._getUniqueId(),this.basemaps.push(a),this._refreshUI(),this.onAdd(a),!0):a&&this._isUniqueId(a.id)?(this.basemaps.push(a),this._refreshUI(),this.onAdd(a),!0):!1},remove:function(a){var b;for(b=0;b<this.basemaps.length;b++){var d=this.basemaps[b];if(d.id===a)return this._selectedBasemap&&
this._selectedBasemap.id===d.id&&(this._selectedBasemap=null),this.basemaps.splice(b,1),this._refreshUI(),this.onRemove(d),d}return null},onLoad:function(){},onSelectionChange:function(){},onAdd:function(a){},onRemove:function(a){},onError:function(a){},_defaultBasemapGalleryGroupQuery:'title:"ArcGIS Online Basemaps" AND owner:esri',_basemapGalleryGroupQuery:null,_finishStartup:function(){this.loaded=!0;this.onLoad();0===this.map.layerIds.length&&(0<this.basemaps.length&&!this._selectBasemapInProgress)&&
this._select(this.basemaps[0].id)},_findCustomBasemapsGroup:function(a){this.basemapsGroup&&this.basemapsGroup.id?this._findArcGISBasemaps(this.basemapsGroup.id,a):(this._basemapGalleryGroupQuery='title:"'+this.basemapsGroup.title+'" AND owner:'+this.basemapsGroup.owner,this._findArcGISBasemapsGroup(a))},_findArcGISBasemapsGroup:function(a){if(this._basemapGalleryGroupQuery)this._findArcGISBasemapsGroupContent(a);else{var b=this.arcgisUrl+"/accounts/self",d={f:"json"};d.culture=p.locale;h({url:b,
content:d,callbackParamName:"callback",load:f.hitch(this,function(b,d){this._basemapGalleryGroupQuery=b&&b.basemapGalleryGroupQuery?b.basemapGalleryGroupQuery:this._defaultBasemapGalleryGroupQuery;this._findArcGISBasemapsGroupContent(a)}),error:f.hitch(this,function(a,b){this._basemapGalleryGroupQuery=this._defaultBasemapGalleryGroupQuery})})}},_findArcGISBasemapsGroupContent:function(a){var b=f.hitch(this,"_findArcGISBasemaps"),d=this.arcgisUrl+"/community/groups",c={};c.q=this._basemapGalleryGroupQuery;
c.f="json";h({url:d,content:c,callbackParamName:"callback",load:f.hitch(this,function(d,c){if(0<d.results.length)b(d.results[0].id,a);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:f.hitch(this,function(a){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_findArcGISBasemaps:function(a,b){var d=this.arcgisUrl+"/search",c={};c.q="group:"+a+' AND type:"web map"';c.sortField="name";c.sortOrder="desc";c.num=50;c.f="json";h({url:d,
content:c,callbackParamName:"callback",load:f.hitch(this,function(a,d){if(0<a.results.length)b(a.results);else this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")}),error:f.hitch(this,function(a,b){this.onError("esri.dijit.BasemapGallery: could not find group for basemaps.")})})},_handleArcGISBasemapsResponse:function(a){0<a.length&&(e.forEach(a,function(a,d){if(this.bingMapsKey||!this.bingMapsKey&&a.title&&-1==a.title.indexOf("Bing Maps")){var c={};c.id=this._getUniqueId();
c.title=a.title;c.thumbnailUrl="";if(a.thumbnail&&a.thumbnail.length&&(c.thumbnailUrl=this.arcgisUrl+"/content/items/"+a.id+"/info/"+a.thumbnail,l.id)){var e=l.id.findCredential(z.urlToObject(this.arcgisUrl).path);e&&(c.thumbnailUrl+="?token\x3d"+e.token)}c.itemId=a.id;c=new E(c,this);this.basemaps.splice(0,0,c)}},this),this._finishStartup())},_refreshUI:function(){this._hasUI&&(g.empty(this.flowContainer),e.forEach(this.basemaps,function(a,b){a.id||(a.id="basemap_"+b);this.flowContainer.appendChild(this._buildNodeLayout(a))},
this),g.create("br",{style:{clear:"both"}},this.flowContainer),this._markSelected(this._selectedBasemap))},_buildNodeLayout:function(a){var b=g.create("div",{id:"galleryNode_"+a.id,"class":"esriBasemapGalleryNode"}),d=g.create("a",{href:"javascript:void(0);"},b);n.connect(d,"onclick",f.hitch(this,"_onNodeClick",a));a.thumbnailUrl?g.create("img",{"class":"esriBasemapGalleryThumbnail",src:a.thumbnailUrl},d):g.create("img",{"class":"esriBasemapGalleryThumbnail",src:this.basePath.toString()+"images/transparent.gif"},
d);d=g.create("div",{"class":"esriBasemapGalleryLabelContainer"},b);a=a.title||"";g.create("span",{innerHTML:a,alt:a,title:a},d);return b},_onNodeClick:function(a,b){b.preventDefault();this._markSelected(a);this.select(a.id)},_markSelected:function(a){a&&(e.forEach(p.query(".esriBasemapGallerySelectedNode",this.domNode),function(a){q.remove(a,"esriBasemapGallerySelectedNode")}),(a=w.byId("galleryNode_"+a.id))&&q.add(a,"esriBasemapGallerySelectedNode"))},_select:function(a){this._selectBasemapInProgress=
!0;var b=this.get(a);b?(b.layers?this._getServiceInfos(b):(a=b.getLayers(this.arcgisUrl),f.isArray(a)?this._getServiceInfos(b):a.addCallback(f.hitch(this,function(a){this._getServiceInfos(b)}))),this._markSelected(b)):this._selectBasemapInProgress=!1},_getServiceInfos:function(a){"https:"==location.protocol&&e.forEach(a.layers,function(a){if(this._isAgolService(a.url)||this._isHostedService(a.url))a.url=a.url.replace("http:","https:")},this);this._selectedBasemap=a;var b=[];e.forEach(a.layers,function(a){a.url&&
(0<a.url.length&&!a.isReference&&!a.type)&&(a.deferredsPos=b.length,b.push(this._getServiceInfo(a.url)))},this);0<b.length?(new v(b)).addCallback(f.hitch(this,function(b){var c=null;e.forEach(a.layers,function(a){if(0===a.deferredsPos||a.deferredsPos){a.serviceInfoResponse=b[a.deferredsPos][1];var e=a.serviceInfoResponse.fullExtent;e||(e=a.serviceInfoResponse.extent);c=c?c.union(new m(e)):new m(e)}},this);this.map.extent&&5>this._getIntersectionPercent(c,this.map.extent)&&this.map.setExtent(c,!0);
this._switchBasemapLayers(a);this._updateReferenceLayer(a)})):(this._switchBasemapLayers(a),this._updateReferenceLayer(a))},_switchBasemapLayers:function(a){a=a.layers;if(0<this.map.layerIds.length&&0===this.map.getNumLevels()&&("OpenStreetMap"===a[0].type||a[0].type&&-1<a[0].type.indexOf("BingMaps")||"WebTiledLayer"===a[0].type))this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");else{e.forEach(a,function(a){if(!a.isReference&&
a.type&&-1<a.type.indexOf("BingMaps")&&!this.bingMapsKey)this.onError("esri.dijit.BasemapGallery: Invalid Bing Maps key.")},this);this._removeBasemapLayers();var b=0;e.forEach(a,function(a){if(!a.isReference){var c;if("OpenStreetMap"===a.type){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}c=new A({id:"layer_osm",opacity:a.opacity})}else if(a.type&&
-1<a.type.indexOf("BingMaps")){if(0<this.map.layerIds.length&&0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}c=k.MAP_STYLE_AERIAL_WITH_LABELS;"BingMapsAerial"==a.type?c=k.MAP_STYLE_AERIAL:"BingMapsRoad"==a.type&&(c=k.MAP_STYLE_ROAD);c=new k({id:"layer_bing",bingMapsKey:this.bingMapsKey,mapStyle:c,opacity:a.opacity})}else if("WebTiledLayer"==a.type){if(0<this.map.layerIds.length&&
0===this.map.getNumLevels()){this.onError("esri.dijit.BasemapGallery: Unable to switch basemap because new basemap is a tiled service and cannot be loaded as a dynamic layer.");return}c=new D(a.url,{visible:a.visibility,opacity:a.opacity,copyright:a.copyright,fullExtent:a.fullExtent,initialExtent:a.initialExtent||a.fullExtent,subDomains:a.subDomains,tileInfo:a.tileInfo,tileServers:a.tileServers})}else a.serviceInfoResponse&&a.serviceInfoResponse.mapName?c=(0===this.map.layerIds.length||0<this.map.getNumLevels())&&
!0===a.serviceInfoResponse.singleFusedMapCache?this._loadAsCached(a):this._loadAsDynamic(a):a.serviceInfoResponse&&a.serviceInfoResponse.pixelSizeX&&(c=new s,c.bandIds=a.bandIds,!a.bandIds&&(a.serviceInfoResponse.bandCount&&3<parseInt(a.serviceInfoResponse.bandCount))&&(c.bandIds=[0,1,2]),c=new r(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,imageServiceParameters:c}));c&&(c._basemapGalleryLayerType="basemap",this.map.addLayer(c,b),b++)}},this);this._selectBasemapInProgress=
!1;this.onSelectionChange()}},_removeBasemapLayers:function(){var a=this.map.layerIds,b=[];e.forEach(a,function(a){a=this.map.getLayer(a);"basemap"===a._basemapGalleryLayerType&&b.push(a)},this);0===b.length&&0<a.length&&b.push(this.map.getLayer(a[0]));0<b.length&&e.forEach(b,function(a){this.map.removeLayer(a)},this)},_updateReferenceLayer:function(a){var b;this._removeReferenceLayer();for(b=0;b<a.layers.length;b++)!0===a.layers[b].isReference&&this._addReferenceLayer(a.layers[b])},_removeReferenceLayer:function(){var a;
for(a=this.map.layerIds.length-1;0<=a;a--){var b=this.map.getLayer(this.map.layerIds[a]);"reference"===b._basemapGalleryLayerType&&this.map.removeLayer(b)}},_addReferenceLayer:function(a){this._getServiceInfo(a.url,f.hitch(this,"_handleReferenceServiceInfoResponse",a))},_handleReferenceServiceInfoResponse:function(a,b,d){var c;(a.serviceInfoResponse=b)&&b.mapName?c=!0===b.singleFusedMapCache?this._loadAsCached(a):this._loadAsDynamic(a):b&&b.pixelSizeX&&(d=new s,d.bandIds=a.bandIds,!a.bandIds&&(b.bandCount&&
3<parseInt(b.bandCount))&&(d.bandIds=[0,1,2]),c=new r(a.url,{resourceInfo:b,opacity:a.opacity,visible:a.visibility,imageServiceParameters:d}));c&&(c._basemapGalleryLayerType="reference",this.map.addLayer(c))},_getServiceInfo:function(a,b){return h({url:a,content:{f:"json"},callbackParamName:"callback",load:function(a,c){b&&b(a,c)},error:f.hitch(this,function(a,b){this.onError("esri.dijit.BasemapGallery: service not accessible.")})})},_loadAsCached:function(a){var b=[];a.displayLevels||(b=e.map(a.serviceInfoResponse.tileInfo.lods,
function(a){return a.level}));var d=null;a.exclusionAreas&&a.exclusionAreas.length&&(d=[],e.forEach(a.exclusionAreas,function(a){d.push({minZoom:a.minZoom,maxZoom:a.maxZoom,minScale:a.minScale,maxScale:a.maxScale,geometry:new m(a.geometry)})}));return new B(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility,exclusionAreas:d,displayLevels:a.displayLevels||b})},_loadAsDynamic:function(a){var b=new C(a.url,{resourceInfo:a.serviceInfoResponse,opacity:a.opacity,visible:a.visibility});
a.visibleLayers&&b.setVisibleLayers(a.visibleLayers);return b},_getIntersectionPercent:function(a,b){var d=b.intersects(a);if(d){var d=d.getWidth()*d.getHeight(),c=b.getWidth()*b.getHeight();return 100*(d/c)}return 0},_getIds:function(){var a=[];e.forEach(this.basemaps,function(b){a.push(b.id)},this);return a},_getUniqueId:function(){for(var a=","+this._getIds().toString()+",",b=0;;)if(-1<a.indexOf(",basemap_"+b+","))b++;else return"basemap_"+b},_isUniqueId:function(a){return-1===(","+this._getIds().toString()+
",").indexOf(","+a+",")?!0:!1},_isAgolService:function(a){return!a?!1:-1!==a.indexOf("/services.arcgisonline.com/")||-1!==a.indexOf("/server.arcgisonline.com/")},_isHostedService:function(a){return!a?!1:-1!==a.indexOf(".arcgis.com/")}})});},
// Source: lib/esri/dijit/PopupMobile.js
'esri/dijit/PopupMobile': function() {
//>>built
define(["require","dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/array","dojo/_base/window","dojo/_base/kernel","dojo/has","dojo/query","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","../InfoWindowBase","../PopupBase","./InfoView","./NavigationBar","../kernel","../domUtils","dojo/i18n!../nls/jsapi","dojo/NodeList-dom"],function(n,t,r,b,q,s,h,C,D,u,v,e,p,w,m,x,y,z,A,E,g,B){return t([x,y],{declaredClass:"esri.dijit.PopupMobile",offsetX:3,offsetY:3,zoomFactor:4,
marginLeft:10,marginTop:10,highlight:!0,popupNavigationBar:null,popupInfoView:null,location:null,xIcon:n.toUrl("./images/whitex.png"),dArrowIcon:n.toUrl("./images/whitedown.png"),lArrowIcon:n.toUrl("./images/whitel.png"),rArrowIcon:n.toUrl("./images/whiter.png"),constructor:function(a,c){this.initialize();r.mixin(this,a);this.domNode=u.byId(c);this._nls=r.mixin({},B.widgets.popup);var f=this.domNode;e.add(f,"esriPopupMobile");v.set(f,"innerHTML","\x3cdiv class\x3d'sizer'\x3e\x3cdiv class\x3d'titlePane'\x3e\x3cdiv class\x3d'spinner hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'title'\x3e\x3c/div\x3e\x3cdiv style\x3d'text-align:center'\x3e\x3cdiv class\x3d'titleButton prev hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'footer' style\x3d'display:inline-block;width:60px;height:15px;'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton next hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton close'\x3e\x3c/div\x3e\x3cdiv class\x3d'titleButton arrow hidden'\x3e\x3c/div\x3e\x3c/div\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer top hidden'\x3e\x3c/div\x3e\x3cdiv class\x3d'pointer bottom hidden'\x3e\x3c/div\x3e");
var d=h.query(".titlePane",f)[0];this._arrowButton=h.query(".arrow",d)[0];this._pointerTop=h.query(".top",f)[0];this._pointerBottom=h.query(".bottom",f)[0];this._title=h.query(".title",d)[0];this._footer=h.query(".footer",d)[0];this._prev=h.query(".prev",d)[0];this._next=h.query(".next",d)[0];this._spinner=h.query(".spinner",d)[0];this._eventConnections=[b.connect(h.query(".close",d)[0],"onclick",this,this.hide),b.connect(this._arrowButton,"onclick",this,this._toggleView),b.connect(this._prev,"onclick",
this,function(){this.selectPrevious();this._updateUI()}),b.connect(this._next,"onclick",this,function(){this.selectNext();this._updateUI()})];this._initPopupNavigationBar();this._initPopupInfoView();g.hide(f);this.isShowing=!1},setMap:function(a){this.inherited(arguments);p.place(this.domNode,a.root);this.highlight&&this.enableHighlight(a)},unsetMap:function(){this.disableHighlight(this.map);this.inherited(arguments)},setTitle:function(a,c){this.destroyDijits(this._title);this.place(a,this._title);
this.destroyDijits(this._footer);this.place(c,this._footer);this.isShowing&&(this.startupDijits(this._title),this.startupDijits(this._footer))},setContent:function(a){this.destroyDijits(this._contentPane);this.place(a,this._contentPane);this.startupDijits(this._contentPane)},show:function(a){if(a){var c=this.map;a.spatialReference?(this.location=a,a=c.toScreen(a)):this.location=c.toMap(a);this._maximized?this.restore():this._setPosition(a);this.isShowing||(g.show(this.domNode),this.isShowing=!0,this.onShow())}else g.show(this.domNode),
this.isShowing=!0},hide:function(){this.isShowing&&(g.hide(this.domNode),this.isShowing=!1,this.onHide())},onShow:function(){this._followMap();this.startupDijits(this._title);this.showHighlight()},onHide:function(){this._unfollowMap();this.hideHighlight()},destroy:function(){this.map&&this.unsetMap();this.cleanup();this.isShowing&&this.hide();this.destroyDijits(this._title);this.destroyDijits(this._footer);q.forEach(this._eventConnections,b.disconnect);p.destroy(this.domNode)},selectNext:function(){this.select(this.selectedIndex+
1)},selectPrevious:function(){this.select(this.selectedIndex-1)},setFeatures:function(){this.inherited(arguments);this._updateUI()},onSetFeatures:function(){},onClearFeatures:function(){this.setTitle("\x26nbsp;","\x26nbsp;");e.add(this._arrowButton,"hidden");this._updateUI();this.hideHighlight()},onSelectionChange:function(){var a=this.selectedIndex;this._updateUI();0<=a&&(this.setContent(this.features[a].getContent()),this.updateHighlight(this.map,this.features[a]),this.isShowing&&this.showHighlight())},
onDfdComplete:function(){this._updateUI()},_followMap:function(){this._unfollowMap();var a=this.map;this._handles=[b.connect(a,"onPanStart",this,this._onPanStart),b.connect(a,"onPan",this,this._onPan),b.connect(a,"onZoomStart",this,this._onZoomStart),b.connect(a,"onExtentChange",this,this._onExtentChange)]},_unfollowMap:function(){var a=this._handles;a&&(q.forEach(a,b.disconnect),this._handles=null)},_onPanStart:function(){var a=this.domNode.style;this._panOrigin={left:a.left,top:a.top,right:a.right,
bottom:a.bottom}},_onPan:function(a,c){var f=this._panOrigin,d=c.x,e=c.y,b=f.left,k=f.top,l=f.right,f=f.bottom;b&&(b=parseFloat(b)+d+"px");k&&(k=parseFloat(k)+e+"px");l&&(l=parseFloat(l)-d+"px");f&&(f=parseFloat(f)-e+"px");m.set(this.domNode,{left:b,top:k,right:l,bottom:f})},_onZoomStart:function(){g.hide(this.domNode)},_onExtentChange:function(a,c,f){f&&(g.show(this.domNode),this.show(this._targetLocation||this.location),this._targetLocation=null)},_setPosition:function(a){var c=a.x;a=a.y;var f=
w.getContentBox(this.map.container),d=f.w,f=f.h,b=0,g=a+10,k=118,l=d-18;18<c&&c<l?(b=c-130,0>b?b=0:b>d-260&&(b=d-260)):18>=c?b=c-18:c>=l&&(b=d-260+(c-l));118<c&&c<d-130?k=118:118>=c?18<c?k=c-12:18>=c&&(k=6):c>=d-130&&(c<l?k=118+c-(d-130):c>=l&&(k=118+l-(d-130)));a<=f/2?(m.set(this.domNode,{left:b+"px",top:g+"px",bottom:null}),m.set(this._pointerTop,{left:k+"px"}),e.add(this._pointerBottom,"hidden"),e.remove(this._pointerTop,"hidden")):(m.set(this.domNode,{left:b+"px",top:g-64+"px",bottom:null}),m.set(this._pointerBottom,
{left:k+"px"}),e.add(this._pointerTop,"hidden"),e.remove(this._pointerBottom,"hidden"))},_showPointer:function(a){q.forEach(["topLeft","topRight","bottomRight","bottomLeft"],function(c){c===a?h.query(".pointer."+c,this.domNode).removeClass("hidden"):h.query(".pointer."+c,this.domNode).addClass("hidden")},this)},_toggleView:function(){this.popupNavigationBar||this._initPopupNavigationBar();this.popupInfoView||this._initPopupInfoView();this.hide();g.show(this.popupNavigationBar.container);g.show(this.popupInfoView.container);
0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())},_handleNavigationBar:function(a){this.popupInfoView.animateTo(0);switch(a.name){case "CloseButton":g.hide(this.popupNavigationBar.container);g.hide(this.popupInfoView.container);this.hide();break;case "ToggleButton":g.hide(this.popupNavigationBar.container);g.hide(this.popupInfoView.container);this.show(this.location);break;case "PreviousButton":this.selectPrevious();this._updateUI();break;case "NextButton":this.selectNext(),
this._updateUI()}},_initPopupNavigationBar:function(){var a={};a.items=[{name:"CloseButton",type:"img",src:this.xIcon,srcAlt:this.xIcon,position:"left"},{name:"Title",type:"span",text:"",position:"center"},{name:"ToggleButton",type:"img",src:this.dArrowIcon,srcAlt:this.dArrowIcon,position:"right",toggleGroup:"toggle"},{name:"PreviousButton",type:"img",src:this.lArrowIcon,srcAlt:this.lArrowIcon,position:"right2",toggleGroup:"previous"},{name:"NextButton",type:"img",src:this.rArrowIcon,srcAlt:this.rArrowIcon,
position:"right1",toggleGroup:"next"}];this.popupNavigationBar=new A(a,p.create("div",{},s.body()));b.connect(this.popupNavigationBar,"onCreate",this,function(a){this._prevFeatureButton=a[3]._node;this._nextFeatureButton=a[4]._node});b.connect(this.popupNavigationBar,"onSelect",this,this._handleNavigationBar);b.connect(this.popupNavigationBar,"onUnSelect",this,this._handleNavigationBar);this.popupNavigationBar.startup();g.hide(this.popupNavigationBar.container)},_initPopupInfoView:function(){this.popupInfoView=
new z({items:[{name:"Navigator",type:"div",text:""},{name:"content",type:"div",text:""},{name:"attachment",type:"div",text:""}]},p.create("div",{},s.body()));e.add(this.popupInfoView.container,"esriMobilePopupInfoView");this.popupInfoView.enableTouchScroll();b.connect(this.popupInfoView,"onCreate",this,function(a){this._contentPane=a[1]._node;0<=this.selectedIndex&&this.setContent(this.features[this.selectedIndex].getContent())});b.connect(this.popupInfoView,"onSwipeLeft",this,function(){});b.connect(this.popupInfoView,
"onSwipeRight",this,function(){});this.popupInfoView.startup()},_updateUI:function(){var a="\x26nbsp;",c="\x26nbsp;",b=this.selectedIndex,d=this.features,g=this.deferreds,h=this._prevFeatureButton.parentNode,k=this._nextFeatureButton.parentNode,l=this._spinner,m=this._nls;d&&1<=d.length?(a=d[b].getTitle(),c=b+1+" of "+d.length,e.remove(this._arrowButton,"hidden"),0===b?(e.add(h,"hidden"),e.add(this._prev,"hidden")):(e.remove(h,"hidden"),e.remove(this._prev,"hidden")),b===d.length-1?(e.add(k,"hidden"),
e.add(this._next,"hidden")):(e.remove(k,"hidden"),e.remove(this._next,"hidden"))):(e.add(this._arrowButton,"hidden"),e.add(h,"hidden"),e.add(k,"hidden"),e.add(this._prev,"hidden"),e.add(this._next,"hidden"));this.setTitle(a,c);this.popupNavigationBar.getItems()[1]._node.innerHTML=c;g&&g.length?(e.remove(l,"hidden"),this.setTitle(m.NLS_searching+"...","\x26nbsp;")):(e.add(l,"hidden"),(!d||!d.length)&&this.setTitle("No Information","\x26nbsp;"))}})});},
// Source: lib/esri/dijit/OverviewMap.js
'esri/dijit/OverviewMap': function() {
//>>built
define(["require","dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/html","dojo/has","dojo/sniff","dojo/dom-class","dojo/dom-style","dojo/dnd/Moveable","dijit/_Widget","dijit/_Templated","../map","../geometry/Point","../geometry/ScreenPoint","../layers/TiledMapServiceLayer","../layers/DynamicMapServiceLayer","../layers/ArcGISTiledMapServiceLayer","../layers/ArcGISDynamicMapServiceLayer","../layers/ArcGISImageServiceLayer","../layers/OpenStreetMapLayer","../virtualearth/VETiledLayer","../kernel","../config","../domUtils","dojo/text!./templates/OverviewMap.html","dojo/i18n!../nls/jsapi"],function(n,p,m,c,q,F,G,d,g,r,s,t,u,k,v,w,x,y,z,A,B,C,H,l,f,D,E){return p([s,t],{declaredClass:"esri.dijit.OverviewMap",widgetsInTemplate:!0,templateString:D,basePath:n.toUrl(".")+"/",constructor:function(a,b){m.mixin(this,E.widgets.overviewMap);a=a||{};if(a.map){var e={};b&&(this._detached=!0,e=q.coords(b,!0));this.map=a.map;this.baseLayer=a.baseLayer;this.width=a.width||e.w||this.map.width/4;this.height=a.height||e.h||this.map.height/4;this.attachTo=a.attachTo||"top-right";this.expandFactor=a.expandFactor||
2;this.color=a.color||"#000000";this.opacity=a.opacity||0.5;this.maximizeButton=!!a.maximizeButton;this.visible=!!a.visible;if(this.map.loaded)this._initialSetup();else var h=c.connect(this.map,"onLoad",this,function(){c.disconnect(h);h=null;this._initialSetup()});this._detached&&(this.visible=!0);this._maximized=!1}else console.error("esri.dijit.OverviewMap: "+this.NLS_noMap)},startup:function(){this.inherited(arguments);this.domNode.parentNode||this.map.container.appendChild(this.domNode);this._detached?
(g.set(this._body,"display","block"),g.set(this._controllerDiv,"display","none"),g.set(this._maximizerDiv,"display","none"),this.map.loaded?this._initialize():c.connect(this.map,"onLoad",this,this._initialize)):("bottom"===this.attachTo.split("-")[0]&&this.domNode.insertBefore(this._maximizerDiv,this._controllerDiv),this.maximizeButton||d.add(this._maximizerDiv,"ovwDisabledButton"),d.add(this.domNode,{"top-left":"ovwTL","top-right":"ovwTR","bottom-left":"ovwBL","bottom-right":"ovwBR"}[this.attachTo]),
d.add(this._controllerDiv,"ovwShow"),d.add(this._maximizerDiv,"ovwMaximize"),this.visible&&this.map.loaded&&(this.visible=!1,this.show()));g.set(this._focusDiv,"opacity",this.opacity)},destroy:function(){this._deactivate();this.overviewMap&&this.overviewMap.destroy();this.overviewMap=this.baseLayer=null;this.inherited(arguments)},resize:function(a){a&&!(0>=a.w||0>=a.h)&&this._resize(a.w,a.h)},show:function(){if(!this.visible){var a=this._controllerDiv;a.title=this.NLS_hide;d.remove(a,"ovwShow");d.add(a,
"ovwHide");f.show(this._body);f.show(this._maximizerDiv);this._initialize();this.visible=!0}},hide:function(){if(this.visible){var a=this._controllerDiv;a.title=this.NLS_show;d.remove(a,"ovwHide");d.add(a,"ovwShow");this._maximized&&this._maximizeHandler();f.hide(this._body);f.hide(this._maximizerDiv);this._deactivate();this.visible=!1}},_initialSetup:function(){if(this._mainMapLayer=this.map.getLayer(this.map.layerIds[0])){var a=this.baseLayer||this._mainMapLayer,b=this.map.spatialReference,e=a.spatialReference;
if(e.wkid!==b.wkid&&e.wkt!==b.wkt)console.error("esri.dijit.OverviewMap: "+this.NLS_invalidSR);else{b=a.declaredClass;if(a instanceof w)if(-1!==b.indexOf("VETiledLayer"))this.baseLayer=new C({resourceInfo:a.getResourceInfo(),culture:a.culture,mapStyle:a.mapStyle,bingMapsKey:a.bingMapsKey});else if(-1!==b.indexOf("OpenStreetMapLayer"))this.baseLayer=new B({tileServers:a.tileServers});else if(-1!==b.indexOf("WebTiledLayer")){var b=a.initialExtent,e=a.fullExtent,h=a.tileInfo;this.baseLayer=new a.constructor(a.urlTemplate,
{initialExtent:b&&new b.constructor(b.toJson()),fullExtent:e&&new e.constructor(e.toJson()),tileInfo:h&&new h.constructor(h.toJson()),tileServers:a.tileServers&&a.tileServers.slice(0)})}else this.baseLayer=new y(a.url,{resourceInfo:a.getResourceInfo()});else if(a instanceof x)-1!==b.indexOf("ArcGISImageServiceLayer")?this.baseLayer=new A(a.url):(this.baseLayer=new z(a.url),this.baseLayer.setImageFormat("png24"));else{console.error("esri.dijit.OverviewMap: "+this.NLS_invalidType);return}!this._detached&&
(this.visible&&this._controllerDiv)&&(a=function(){this.visible=!1;this.show()},this.baseLayer.loaded?a.call(this):c.connect(this.baseLayer,"onLoad",this,a))}}else console.error("esri.dijit.OverviewMap: "+this.NLS_noLayer)},_visibilityHandler:function(){this.visible?this.hide():this.show()},_maximizeHandler:function(){var a=this._maximizerDiv;this._maximized?(a.title=this.NLS_maximize,d.remove(a,"ovwRestore"),d.add(a,"ovwMaximize"),this._resize(this.width,this.height)):(a.title=this.NLS_restore,d.remove(a,
"ovwMaximize"),d.add(a,"ovwRestore"),this._resize(this.map.width,this.map.height));this._maximized=!this._maximized},_resize:function(a,b){g.set(this._body,{width:a+"px",height:b+"px"});var e=l.defaults.map.panDuration,c=this.overviewMap;l.defaults.map.panDuration=0;c&&(c.resize(!0),c.centerAt(this._focusExtent.getCenter()));l.defaults.map.panDuration=e},_initialize:function(){if(this.overviewMap)this._activate();else{var a;a=this.overviewMap=new u(this.id+"-map",{slider:!1,showAttribution:!1,logo:!1,
lods:this._overviewLods,wrapAround180:this.map.wrapAround180});c.connect(a,"onLoad",this,function(){this._map_resize_override=m.hitch(a,this._map_resize_override);a.disableMapNavigation();this._activate()});a.addLayer(this.baseLayer)}},_activate:function(){var a=this.map,b=this.overviewMap;this._moveableHandle=new r(this._focusDiv);this._soeConnect=c.connect(a,"onExtentChange",this,this._syncOverviewMap);this._ufoConnect=c.connect(a,"onPan",this,this._updateFocus);this._oecConnect=c.connect(b,"onExtentChange",
this,this._ovwExtentChangeHandler);this._opaConnect=c.connect(b,"onPan",this,this._ovwPanHandler);this._ozsConnect=c.connect(b,"onZoomStart",this,function(){f.hide(this._focusDiv)});this._ozeConnect=c.connect(b,"onZoomEnd",this,function(){f.show(this._focusDiv)});this._omsConnect=c.connect(this._moveableHandle,"onMoveStop",this,this._moveStopHandler);this._syncOverviewMap(a.extent,null,null,null)},_deactivate:function(){c.disconnect(this._soeConnect);c.disconnect(this._ufoConnect);c.disconnect(this._oecConnect);
c.disconnect(this._opaConnect);c.disconnect(this._ozsConnect);c.disconnect(this._ozeConnect);c.disconnect(this._omsConnect);this._moveableHandle&&this._moveableHandle.destroy()},_syncOverviewMap:function(a,b,e,c){this._suspendPanHandling?this._suspendPanHandling=!1:(this._focusExtent=a,this.overviewMap.setExtent(a.expand(this.expandFactor),!0))},_updateFocus:function(a){this._suspendPanHandling||(this._focusExtent=a,this._drawFocusDiv(a))},_drawFocusDiv:function(a,b){var e=this.overviewMap,c=e.toScreen(new k(a.xmin,
a.ymax,e.spatialReference)),d=e.toScreen(new k(a.xmax,a.ymin,e.spatialReference)),e=d.x-c.x,d=d.y-c.y,f=!0;e>this.overviewMap.width&&d>this.overviewMap.height&&(f=!1);g.set(this._focusDiv,{left:c.x+(b?b.x:0)+"px",top:c.y+(b?b.y:0)+"px",width:e+"px",height:d+"px",display:f?"block":"none"})},_moveStopHandler:function(a){var b=this._moveableHandle.node.style;a=this._focusExtent;var c=this.overviewMap,b=c.toMap(new v(parseInt(b.left,10),parseInt(b.top,10))),d=new k(a.xmin,a.ymax,c.spatialReference);this._focusExtent=
a.offset(b.x-d.x,b.y-d.y);this._maximized?this._maximizeHandler():c.centerAt(this._focusExtent.getCenter());this._suspendPanHandling=!0;this.map.setExtent(this._focusExtent)},_ovwExtentChangeHandler:function(){this._drawFocusDiv(this._focusExtent)},_ovwPanHandler:function(a,b){this._drawFocusDiv(this._focusExtent,b)}})});},
// Source: lib/esri/virtualearth/VETiledLayer.js
'esri/virtualearth/VETiledLayer': function() {
//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/_base/array","dojo/_base/config","dojo/has","dojo/string","dojo/_base/Deferred","../kernel","../urlUtils","../SpatialReference","../layers/TileInfo","../layers/TiledMapServiceLayer","../geometry/Extent","../request"],function(g,d,h,m,n,v,k,p,w,q,l,r,s,t,u){g=g(s,{declaredClass:"esri.virtualearth.VETiledLayer",constructor:function(a){try{a=d.mixin({bingMapsKey:null,culture:"en-US"},a||{});var b=window.location.protocol;"file:"===b&&(b="http:");this.url=
b+"//dev.virtualearth.net/REST/v1";this._url=q.urlToObject(this.url);this.spatialReference=new l({wkid:102100});this.tileInfo=new r({rows:256,cols:256,dpi:96,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,
resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,scale:144447.638572},{level:13,resolution:19.1092570712683,
scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.initialExtent=this.fullExtent=new t(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new l({wkid:102100}));
d.mixin(this,a);this.hasAttributionData=this.showAttribution;this._initLayer=d.hitch(this,this._initLayer);this._errorHandler=d.hitch(this,this._errorHandler);this._getTileInfo=d.hitch(this,this._getTileInfo);if(this.bingMapsKey)this._getTileInfo();else throw Error("BingMapsKey must be provided.");}catch(c){throw this.onError(c),c;}},_unsetMap:function(a,b){this.inherited("_unsetMap",arguments)},_getTileInfo:function(){if(this.mapStyle){var a=this._url.path+"/Imagery/Metadata/"+this.mapStyle;if(this.bingMapsKey){var b=
this.resourceInfo;!this.loaded&&b?this._initLayer(b):u({url:a,content:d.mixin({},{key:this.bingMapsKey,ss:!0,c:this.culture,include:this.hasAttributionData?"imageryProviders":null}),callbackParamName:"jsonp",load:this._initLayer,error:this._errorHandler})}}},_initLayer:function(a,b){if(200!==a.statusCode){var c=Error();c.code=a.statusCode;c.message=a.statusDescription;c.details=a.errorDetails;c.authenticationResultCode=a.authenticationResultCode;this.onError(c)}else try{this.resourceInfo=h.toJson(a);
var c=a.resourceSets[0].resources[0],d=c.imageUrl.replace("{","${");this.tileServers=m.map(c.imageUrlSubdomains,function(a){var b=window.location.protocol;"file:"===b&&(b="http:");return k.substitute(d,{subdomain:a}).replace("http:",b)});this._tsLength=this.tileServers.length;if(this.loaded)this.refresh(),this.onMapStyleChange();else{this.copyright=this.copyright||"\x26copy; 2012 Microsoft Corporation and its data suppliers";this.loaded=!0;this.onLoad(this);var e=this.loadCallback;e&&(delete this.loadCallback,
e(this))}}catch(f){this.onError(f)}},getAttributionData:function(){var a=new p,b=h.fromJson(this.resourceInfo),c;this.hasAttributionData&&b&&(c=d.getObject("resourceSets.0.resources.0.imageryProviders",!1,b));c?a.callback({contributors:c}):(b=Error("Layer does not have attribution data"),b.log=n.isDebug,a.errback(b));return a},getTileUrl:function(a,b,c){return k.substitute(this.tileServers[b%this._tsLength].replace(/\{/g,"${"),{quadkey:this._getQuadKey(a,b,c),culture:this.culture,token:this.bingMapsKey})},
_getQuadKey:function(a,b,c){var d="",e,f;for(f=a;0<f;f--)a="0",e=1<<f-1,0!=(c&e)&&a++,0!=(b&e)&&(a++,a++),d+=a;return d},setMapStyle:function(a){this.mapStyle=a;this._getTileInfo()},setCulture:function(a){this.culture=a;this._getTileInfo()},setBingMapsKey:function(a){this.bingMapsKey=a},onMapStyleChange:function(){}});d.mixin(g,{MAP_STYLE_AERIAL:"aerial",MAP_STYLE_AERIAL_WITH_LABELS:"aerialWithLabels",MAP_STYLE_ROAD:"road"});return g});},
// Source: lib/esri/dijit/InfoView.js
'esri/dijit/InfoView': function() {
//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/connect","dojo/_base/kernel","dojo/has","dojo/query","dojo/dom","dojo/dom-class","dojo/dom-construct","dojo/dom-geometry","../kernel","./_TouchBase"],function(l,r,m,d,n,s,t,p,h,e,k,u,q){return l(null,{declaredClass:"esri.dijit.InfoView",_items:[],_top:null,_sections:[],_isDecelerate:!1,constructor:function(a,c){var b;this.container=p.byId(c);this._touchBase=q(this.container,null);this._slideDiv=e.create("div",null,this.container,"first");
this.events=[];this._items=a.items;a.sections&&(this._sections=a.sections);h.add(this.container,"esriMobileInfoView");if(0===this._sections.length)e.create("div",{},this._slideDiv);else for(b=0;b<this._sections.length;b++){var d=e.create("div",{"class":"esriMobileInfoViewSection"},this._slideDiv);e.create("div",{innerHTML:this._sections[b].title},d)}for(b=0;b<this._items.length;b++){var f,d=0;this._items[b].section&&(d=this._items[b].section);switch(this._items[b].type){case "div":f=e.create("div",
{"class":"esriMobileInfoViewItem",style:this._items[b].style},this._slideDiv.childNodes[d]),f=e.create("div",{innerHTML:this._items[b].text},f)}this._items[b].className&&h.add(f,this._items[b].className);f._index=b;f._item=this._items[b];this._items[b]._node=f}this.startTouchY=0},startup:function(){this.onCreate(this._items);this._animateTo(0)},destroy:function(){m.forEach(this.events,d.disconnect);this._touchBase=null;n.query("img",this.container).forEach(function(a){a._index=null;a._item=null;e.destroy(a)});
this._items=null;e.destroy(this._slideDiv);e.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},setPreventDefault:function(a){this._touchBase.setPreventDefault(a)},enableTouchScroll:function(){this._touchBase.setPreventDefault(!0);this.events.push(d.connect(this._touchBase,"onTouchStart",this,this._onTouchStartHandler));this.events.push(d.connect(this._touchBase,"onTouchMove",this,this._onTouchMoveHandler));this.events.push(d.connect(this._touchBase,
"onTouchEnd",this,this._onTouchEndHandler));this._slideDiv.style.webkitTransform="translate3d(0,"+this._top+"px, 0)"},disableTouchScroll:function(){d.disconnect(this.events.pop());d.disconnect(this.events.pop());d.disconnect(this.events.pop());this._touchBase.setPreventDefault(!1);this._slideDiv.style.webkitTransform="translate3d(0, 0px, 0)"},animateTo:function(){this._slideDiv.style.WebkitTransitionDuration="0s";this._animateTo(0)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},
onClick:function(a){},onSwipeLeft:function(){},onSwipeRight:function(){},_onTouchStartHandler:function(a){this._slideDiv.style.WebkitTransitionDuration="0s";this._moveDirection=null;this._startTime=new Date;this.startTouchY=a.touches[0].clientY;this.contentStartOffsetY=this.contentOffsetY},_onTouchMoveHandler:function(a){this._moveDirection||(Math.abs(a.curY)>Math.abs(a.curX)?this._moveDirection="vertical":this._moveDirection="horizontal");"horizontal"!==this._moveDirection&&"vertical"===this._moveDirection&&
this._animateTo(a.touches[0].clientY-this.startTouchY+this.contentStartOffsetY)},_onTouchEndHandler:function(a){this._endTime=new Date;this._deltaMovement=a.curY;if("vertical"===this._moveDirection)this._shouldStartMomentum()?this._doMomentum():this._snapToBounds();else if("horizontal"===this._moveDirection)if("left"===a.swipeDirection)this.onSwipeLeft();else if("right"===a.swipeDirection)this.onSwipeRight()},_shouldStartMomentum:function(){this._diff=this._endTime-this._startTime;this._velocity=
this._deltaMovement/this._diff;return 0.2<Math.abs(this._velocity)&&200>this._diff?!0:!1},_pullToStop:function(a){80<Math.abs(a)&&(a=0<a?80:-contentBox.h+parentBox.h-10-80);console.log(a);this._slideDiv.style.webkitTransition="-webkit-transform 200ms cubic-bezier(0, 0, 1, 1)";var c=d.connect(this._slideDiv,"webkitTransitionEnd",this,function(){0<a?this._animateTo(0):this._animateTo(-contentBox.h+parentBox.h-10);d.disconnect(c)});this._animateTo(a)},_doMomentum:function(){var a,c;a=k.getContentBox(this.container);
var b=0>this._velocity?0.0010:-0.0010;c=-(this._velocity*this._velocity)/(2*b);var d=-this._velocity/b,b=3*0.6-0,f=1-b,g=0,e=0;if(a.h>this._slideDiv.scrollHeight)this.contentOffsetY=0,e=300;else if(0<this.contentOffsetY+c){a=0;for(c=Math.floor(d/20);a<c;a++)if(g=(f*20*a^3)+(b*20*a^2)+0*20*a+0,g=0>this._velocity?-g:g,0<this.contentOffsetY+g){e=20*a;break}0===e&&(e=300);this.contentOffsetY=0}else if(Math.abs(this.contentOffsetY+c)+a.h>this._slideDiv.scrollHeight){this.contentOffsetY=a.h-this._slideDiv.scrollHeight;
a=0;for(c=Math.floor(d/20);a<c;a++)if(g=(f*20*a^3)+(b*20*a^2)+0*20*a+0,g=0>this._velocity?-g:g,Math.abs(this.contentOffsetY+g)>this._slideDiv.scrollHeight){e=20*a;break}}else e=d,this.contentOffsetY+=c;this._slideDiv.style.webkitTransition="-webkit-transform "+e+"ms cubic-bezier(0, 0.3, 0.6, 1)";this._animateTo(this.contentOffsetY)},_snapToBounds:function(){var a=k.getContentBox(this.container);a.h>this._slideDiv.scrollHeight?this.contentOffsetY=0:0<this.contentOffsetY?this.contentOffsetY=0:Math.abs(this.contentOffsetY)+
a.h>this._slideDiv.scrollHeight&&(this.contentOffsetY=a.h-this._slideDiv.scrollHeight);this._slideDiv.style.WebkitTransitionDuration="0.5s";this._animateTo(this.contentOffsetY)},_animateTo:function(a){this.contentOffsetY=a;this._slideDiv.style.webkitTransform="translate3d(0, "+a+"px, 0)"},_stopMomentum:function(){if(this._isDecelerating()){var a=document.defaultView.getComputedStyle(this._slideDiv,null),a=new WebKitCSSMatrix(a.webkitTransform);this._slideDiv.style.webkitTransition="";this.animateTo(a.m42)}},
_isDecelerating:function(){return this.isDecelerate?!0:!1},_toggleNode:function(a,c){"ON"===c.toggleState?(c.toggleState="OFF",c.src&&(a.src=c.src.toString()),this.onUnSelect(c)):(c.toggleState="ON",c.srcAlt&&(a.src=c.srcAlt),this.onSelect(c))}})});},
// Source: lib/esri/layers/WebTiledLayer.js
'esri/layers/WebTiledLayer': function() {
//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/_base/url","dojo/has","dojo/string","../kernel","../urlUtils","../SpatialReference","../geometry/Extent","./TiledMapServiceLayer","./TileInfo"],function(m,s,f,n,t,k,u,p,g,l,q,r){return m(q,{declaredClass:"esri.layers.WebTiledLayer",constructor:function(c,a){a||(a={});this.urlTemplate=c;var d=new l(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,2.0037508342787E7,new g({wkid:102100})),e=new l(-2.0037508342787E7,-2.003750834278E7,2.003750834278E7,
2.0037508342787E7,new g({wkid:102100}));this.initialExtent=a.initialExtent||d;this.fullExtent=a.fullExtent||e;this.tileInfo=a.tileInfo?a.tileInfo:new r({rows:256,cols:256,origin:{x:-2.0037508342787E7,y:2.0037508342787E7},spatialReference:{wkid:102100},lods:[{level:0,resolution:156543.033928,scale:5.91657527591555E8},{level:1,resolution:78271.5169639999,scale:2.95828763795777E8},{level:2,resolution:39135.7584820001,scale:1.47914381897889E8},{level:3,resolution:19567.8792409999,scale:7.3957190948944E7},
{level:4,resolution:9783.93962049996,scale:3.6978595474472E7},{level:5,resolution:4891.96981024998,scale:1.8489297737236E7},{level:6,resolution:2445.98490512499,scale:9244648.868618},{level:7,resolution:1222.99245256249,scale:4622324.434309},{level:8,resolution:611.49622628138,scale:2311162.217155},{level:9,resolution:305.748113140558,scale:1155581.108577},{level:10,resolution:152.874056570411,scale:577790.554289},{level:11,resolution:76.4370282850732,scale:288895.277144},{level:12,resolution:38.2185141425366,
scale:144447.638572},{level:13,resolution:19.1092570712683,scale:72223.819286},{level:14,resolution:9.55462853563415,scale:36111.909643},{level:15,resolution:4.77731426794937,scale:18055.954822},{level:16,resolution:2.38865713397468,scale:9027.977411},{level:17,resolution:1.19432856685505,scale:4513.988705},{level:18,resolution:0.597164283559817,scale:2256.994353},{level:19,resolution:0.298582141647617,scale:1128.497176}]});this.spatialReference=new g(this.tileInfo.spatialReference.toJson());this.copyright=
a.copyright||"";var b=new n(c),d=b.scheme+"://"+b.authority+"/";this.urlPath=c.substring(d.length);this.tileServers=a.tileServers||[];-1===b.authority.indexOf("{subDomain}")&&this.tileServers.push(d);if(a.subDomains&&0<a.subDomains.length&&1<b.authority.split(".").length){this.subDomains=a.subDomains;var h;f.forEach(a.subDomains,function(a,c){-1<b.authority.indexOf("${subDomain}")?h=b.scheme+"://"+k.substitute(b.authority,{subDomain:a})+"/":-1<b.authority.indexOf("{subDomain}")&&(h=b.scheme+"://"+
b.authority.replace(/\{subDomain\}/gi,a)+"/");this.tileServers.push(h)},this)}this.tileServers=f.map(this.tileServers,function(a){"/"!==a.charAt(a.length-1)&&(a+="/");return a});this._levelToLevelValue=[];f.forEach(this.tileInfo.lods,function(a){this._levelToLevelValue[a.level]=a.levelValue||a.level},this);this.loaded=!0;this.onLoad(this)},getTileUrl:function(c,a,d){c=this._levelToLevelValue[c];var e=this.tileServers[a%this.tileServers.length]+k.substitute(this.urlPath,{level:c,col:d,row:a}),e=e.replace(/\{level\}/gi,
c).replace(/\{row\}/gi,a).replace(/\{col\}/gi,d),e=this.addTimestampToURL(e);return p.addProxy(e)}})});},
// Source: lib/esri/dijit/NavigationBar.js
'esri/dijit/NavigationBar': function() {
//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/_base/array","dojo/_base/kernel","dojo/has","dojo/query","dojo/dom","dojo/dom-class","dojo/dom-construct","./_TouchBase","../kernel"],function(m,r,k,n,l,s,t,p,g,d,q,u){return m(null,{declaredClass:"esri.dijit.NavigationBar",_items:[],constructor:function(a,b){var c;this.container=p.byId(b);this._touchBase=q(this.container,null);this._slideDiv=d.create("div",{},this.container,"first");this.events=[k.connect(this._touchBase,"onclick",this,
this._onClickHandler)];this._items=a.items;g.add(this.container,"esriMobileNavigationBar");var h=d.create("div",{},this._slideDiv);for(c=0;c<this._items.length;c++){var e,f;switch(this._items[c].type){case "img":f=d.create("div",{"class":"esriMobileNavigationItem"},h);e=d.create("img",{src:this._items[c].src.toString(),style:{width:"100%",height:"100%"}},f);break;case "span":f=d.create("div",{"class":"esriMobileNavigationItem"},h);e=d.create("span",{innerHTML:this._items[c].text},f);break;case "div":f=
d.create("div",{"class":"esriMobileNavigationInfoPanel"},h),e=d.create("div",{innerHTML:this._items[c].text},f)}g.add(f,this._items[c].position);this._items[c].className&&g.add(e,this._items[c].className);e._index=c;e._item=this._items[c];this._items[c]._node=e}},startup:function(){this.onCreate(this._items)},destroy:function(){n.forEach(this.events,k.disconnect);this._touchBase=null;l.query("img",this.container).forEach(function(a){a._index=null;a._item=null;d.destroy(a)});this._items=null;d.destroy(this._slideDiv);
d.destroy(this.container);this.container=this._slideDiv=null},getItems:function(){return this._items},select:function(a){this._markSelected(a._node,a)},onSelect:function(a){},onUnSelect:function(a){},onCreate:function(a){},_onClickHandler:function(a){if("img"===a.target.tagName.toLowerCase()){var b=a.target,c=b._item;l.query("img",this.container).forEach(function(a){a!==b&&a._item.toggleGroup===c.toggleGroup&&this._markUnSelected(a,a._item)},this);this._toggleNode(b,c)}},_toggleNode:function(a,b){"ON"===
b.toggleState?(b.toggleState="OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b)):(b.toggleState="ON",b.srcAlt&&(a.src=b.srcAlt),this.onSelect(b))},_markSelected:function(a,b){b.toggleState="ON";b.srcAlt&&(a.src=b.srcAlt);this.onSelect(b)},_markUnSelected:function(a,b){"ON"===b.toggleState&&(b.toggleState="OFF",b.src&&(a.src=b.src.toString()),this.onUnSelect(b))}})});},
// Source: lib/esri/layers/ImageServiceParameters.js
'esri/layers/ImageServiceParameters': function() {
//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel","../lang"],function(b,e,d,g,h,f){b=b(null,{declaredClass:"esri.layers.ImageServiceParameters",extent:null,width:null,height:null,imageSpatialReference:null,format:null,interpolation:null,compressionQuality:null,bandIds:null,timeExtent:null,mosaicRule:null,renderingRule:null,noData:null,toJson:function(c){var a=this.bbox||this.extent;c=(a=a&&c&&a._normalize(!0))?a.spatialReference.wkid||d.toJson(a.spatialReference.toJson()):
null;var b=this.imageSpatialReference,a={bbox:a?a.xmin+","+a.ymin+","+a.xmax+","+a.ymax:null,bboxSR:c,size:null!==this.width&&null!==this.height?this.width+","+this.height:null,imageSR:b?b.wkid||d.toJson(b.toJson()):c,format:this.format,interpolation:this.interpolation,compressionQuality:this.compressionQuality,bandIds:this.bandIds?this.bandIds.join(","):null,mosaicRule:this.mosaicRule?d.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?d.toJson(this.renderingRule.toJson()):null,
noData:this.noData,noDataInterpretation:this.noDataInterpretation};c=this.timeExtent;a.time=c?c.toJson().join(","):null;return f.filter(a,function(a){if(null!==a&&void 0!==a)return!0})}});e.mixin(b,{INTERPOLATION_BILINEAR:"RSP_BilinearInterpolation",INTERPOLATION_CUBICCONVOLUTION:"RSP_CubicConvolution",INTERPOLATION_MAJORITY:"RSP_Majority",INTERPOLATION_NEARESTNEIGHBOR:"RSP_NearestNeighbor",NODATA_MATCH_ALL:"esriNoDataMatchAll",NODATA_MATCH_ANY:"esriNoDataMatchAny"});return b});},
// Source: lib/esri/dijit/_TouchBase.js
'esri/dijit/_TouchBase': function() {
//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/connect","dojo/dom","dojo/has","../kernel"],function(c,e,b,d,f,g){return c(null,{declaredClass:"esri.dijit._TouchBase",_preventDefault:!0,_swipeThreshold:20,constructor:function(a,c){this.domNode=d.byId(a);this.events=[b.connect(this.domNode,"touchstart",this,this._touchStartHandler),b.connect(this.domNode,"touchmove",this,this._touchMoveHandler),b.connect(this.domNode,"touchend",this,this._touchEndHandler),b.connect(this.domNode,"onclick",
this,this._clickHandler)]},setPreventDefault:function(a){this._preventDefault=a},disableOnClick:function(){b.disconnect(this.events.pop())},_clickHandler:function(a){if(this._moved)a.preventDefault();else this.onclick(a)},_touchStartHandler:function(a){this._moved=!1;this.client_x=a.targetTouches[0].clientX;this.client_y=a.targetTouches[0].clientY;this.down_x=a.targetTouches[0].pageX;this.down_y=a.targetTouches[0].pageY;a.downX=this.down_x;a.downY=this.down_y;this.onTouchStart(a)},_touchMoveHandler:function(a){this._preventDefault&&
a.preventDefault();this._moved=!0;this.up_x=a.targetTouches[0].pageX;this.cur_x=a.targetTouches[0].pageX-this.down_x;this.cur_y=a.targetTouches[0].pageY-this.down_y;a.curX=this.cur_x;a.curY=this.cur_y;this.onTouchMove(a)},_touchEndHandler:function(a){this._moved?(a.curX=this.cur_x,a.curY=this.cur_y,this.down_x-this.up_x>this._swipeThreshold?a.swipeDirection="left":this.up_x-this.down_x>this._swipeThreshold&&(a.swipeDirection="right")):(a.clientX=this.client_x,a.clientY=this.client_y);this.onTouchEnd(a)},
onTouchStart:function(a){},onTouchMove:function(a){},onTouchEnd:function(a){},onclick:function(a){}})});},
// Source: lib/esri/dijit/Basemap.js
'esri/dijit/Basemap': function() {
//>>built
define(["dojo/_base/declare","dojo/_base/array","dojo/_base/lang","dojo/has","../kernel","../request","./BasemapLayer"],function(c,d,b,k,e,f,g){return c(null,{declaredClass:"esri.dijit.Basemap",id:null,title:"",thumbnailUrl:null,layers:null,itemId:null,basemapGallery:null,constructor:function(a,h){a=a||{};!a.layers&&!a.itemId&&console.error("esri.dijit.Basemap: unable to find the 'layers' property in parameters");this.id=a.id;this.itemId=a.itemId;this.layers=a.layers;this.title=a.title||"";this.thumbnailUrl=
a.thumbnailUrl;this.basemapGallery=h},getLayers:function(a){if(this.layers)return this.layers;if(this.itemId)return a=f({url:(a||e.dijit._arcgisUrl)+"/content/items/"+this.itemId+"/data",content:{f:"json"},callbackParamName:"callback",error:b.hitch(this,function(a,b){if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.")})}),a.addCallback(b.hitch(this,function(a,b){if(a.baseMap)return this.layers=
[],d.forEach(a.baseMap.baseMapLayers,function(a){this.layers.push(new g(a))},this),this.layers;if(this.basemapGallery)this.basemapGallery.onError("esri.dijit.Basemap: could not access basemap item.");else console.error("esri.dijit.Basemap: could not access basemap item.");return[]})),a}})});},
// Source: lib/esri/dijit/BasemapLayer.js
'esri/dijit/BasemapLayer': function() {
//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel"],function(b,c,d,e){return b(null,{declaredClass:"esri.dijit.BasemapLayer",constructor:function(a){a=a||{};!a.url&&!a.type&&console.error("esri.dijit.BasemapLayer: unable to find the 'url' or 'type' property in parameters");this.url=a.url;this.type=a.type;this.isReference=!0===a.isReference?!0:!1;this.opacity=a.opacity;this.visibleLayers=a.visibleLayers;this.displayLevels=a.displayLevels;this.exclusionAreas=a.exclusionAreas;this.bandIds=
a.bandIds;this.copyright=a.copyright;this.subDomains=a.subDomains;this.fullExtent=a.fullExtent;this.initialExtent=a.initialExtent;this.tileInfo=a.tileInfo;this.tileServers=a.tileServers}})});},
// Source: lib/esri/layers/MosaicRule.js
'esri/layers/MosaicRule': function() {
//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../lang","../geometry/Point"],function(f,e,k,l,g,h){var b=f(null,{declaredClass:"esri.layers.MosaicRule",method:null,where:null,sortField:null,sortValue:null,ascending:!1,lockRasterIds:null,viewpoint:null,objectIds:null,operation:null,multidimensionalDefinition:[],constructor:function(a){e.isObject(a)&&(e.mixin(this,a),a.mosaicMethod&&(this.method=a.mosaicMethod),this.method&&"esri"!==this.method.toLowerCase().substring(0,4)&&(this.method=
this._getMethodEnum(this.method)),a.mosaicOperation&&(this.operation=a.mosaicOperation),this.operation&&"MT_"!==this.operation.toUpperCase().substring(0,3)&&(this.operation=this._getOperatorEnum(this.operation)),a.fids&&(this.objectIds=a.fids),a.viewpoint&&(this.viewpoint=new h(a.viewpoint)))},toJson:function(){var a=null,b=this.multidimensionalDefinition?this.multidimensionalDefinition.length:0;if(b)for(var a=[],d=0;d<b;d++)a.push("esri.layers.DimensionalDefinition"===this.multidimensionalDefinition[d].declaredClass?
this.multidimensionalDefinition[d].toJson():this.multidimensionalDefinition[d]);a={mosaicMethod:this.method,where:this.where,sortField:this.sortField,sortValue:this.sortValue,ascending:this.ascending,lockRasterIds:this.lockRasterIds,viewpoint:this.viewpoint?this.viewpoint.toJson():null,fids:this.objectIds,mosaicOperation:this.operation,multidimensionalDefinition:a};return g.filter(a,function(a){if(null!==a)return!0})},_getMethodEnum:function(a){if(a){var c=b.METHOD_NONE;switch(a.toLowerCase()){case "byattribute":c=
b.METHOD_ATTRIBUTE;break;case "center":c=b.METHOD_CENTER;break;case "lockraster":c=b.METHOD_LOCKRASTER;break;case "nadir":c=b.METHOD_NADIR;break;case "northwest":c=b.METHOD_NORTHWEST;break;case "seamline":c=b.METHOD_SEAMLINE;break;case "viewpoint":c=b.METHOD_VIEWPOINT}return c}},_getOperatorEnum:function(a){if(a)switch(a.toLowerCase()){case "first":return b.OPERATION_FIRST;case "last":return b.OPERATION_LAST;case "max":return b.OPERATION_MAX;case "min":return b.OPERATION_MIN;case "blend":return b.OPERATION_BLEND;
case "mean":return b.OPERATION_MEAN}}});e.mixin(b,{METHOD_NONE:"esriMosaicNone",METHOD_CENTER:"esriMosaicCenter",METHOD_NADIR:"esriMosaicNadir",METHOD_VIEWPOINT:"esriMosaicViewpoint",METHOD_ATTRIBUTE:"esriMosaicAttribute",METHOD_LOCKRASTER:"esriMosaicLockRaster",METHOD_NORTHWEST:"esriMosaicNorthwest",METHOD_SEAMLINE:"esriMosaicSeamline",OPERATION_FIRST:"MT_FIRST",OPERATION_LAST:"MT_LAST",OPERATION_MIN:"MT_MIN",OPERATION_MAX:"MT_MAX",OPERATION_MEAN:"MT_MEAN",OPERATION_BLEND:"MT_BLEND"});return b});},
// Source: lib/esri/tasks/ImageServiceIdentifyTask.js
'esri/tasks/ImageServiceIdentifyTask': function() {
//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../request","../geometry/normalizeUtils","./Task","./ImageServiceIdentifyResult"],function(b,h,p,q,k,l,m,n){b=b(m,{declaredClass:"esri.tasks.ImageServiceIdentifyTask",constructor:function(a){this._url.path+="/identify";this._handler=h.hitch(this,this._handler)},__msigns:[{n:"execute",c:3,a:[{i:0,p:["geometry"]}],e:2}],_handler:function(a,b,e,d,c){try{var f=new n(a);this._successHandler([f],"onComplete",e,c)}catch(g){this._errorHandler(g,
d,c)}},execute:function(a,b,e,d){var c=d.assembly;a=this._encode(h.mixin({},this._url.query,{f:"json"},a.toJson(c&&c[0])));var f=this._handler,g=this._errorHandler;return k({url:this._url.path,content:a,callbackParamName:"callback",load:function(a,c){f(a,c,b,e,d.dfd)},error:function(a){g(a,e,d.dfd)}})},onComplete:function(){}});l._createWrappers(b);return b});},
// Source: lib/esri/tasks/ImageServiceIdentifyResult.js
'esri/tasks/ImageServiceIdentifyResult': function() {
//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/has","../kernel","../geometry/jsonUtils","./FeatureSet"],function(b,e,f,g,c,d){return b(null,{declaredClass:"esri.tasks.ImageServiceIdentifyResult",constructor:function(a){a.catalogItems&&(this.catalogItems=new d(a.catalogItems));a.location&&(this.location=c.fromJson(a.location));this.catalogItemVisibilities=a.catalogItemVisibilities;this.name=a.name;this.objectId=a.objectId;this.value=a.value;this.properties=a.properties}})});},
// Source: lib/esri/tasks/ImageServiceIdentifyParameters.js
'esri/tasks/ImageServiceIdentifyParameters': function() {
//>>built
define(["dojo/_base/declare","dojo/_base/lang","dojo/_base/json","dojo/has","../kernel","../lang","../geometry/jsonUtils"],function(e,g,c,h,k,d,f){return e(null,{declaredClass:"esri.tasks.ImageServiceIdentifyParameters",geometry:null,mosaicRule:null,renderingRule:null,pixelSizeX:null,pixelSizeY:null,pixelSize:null,returnGeometry:!1,returnCatalogItems:!0,timeExtent:null,toJson:function(a){var b=a&&a.geometry||this.geometry;a={geometry:b,returnGeometry:this.returnGeometry,returnCatalogItems:this.returnCatalogItems,
mosaicRule:this.mosaicRule?c.toJson(this.mosaicRule.toJson()):null,renderingRule:this.renderingRule?c.toJson(this.renderingRule.toJson()):null};b&&(a.geometryType=f.getJsonType(b));b=this.timeExtent;a.time=b?b.toJson().join(","):null;d.isDefined(this.pixelSizeX)&&d.isDefined(this.pixelSizeY)?a.pixelSize=c.toJson({x:parseFloat(this.pixelSizeX),y:parseFloat(this.pixelSizeY)}):this.pixelSize&&(a.pixelSize=this.pixelSize?c.toJson(this.pixelSize.toJson()):null);return a}})});},
// Source: lib/esri/dijit/templates/OverviewMap.html
'url:esri/dijit/templates/OverviewMap.html': '<div class="esriOverviewMap"><div class="ovwContainer" dojoattachpoint="_body" style="width: ${width}px; height: ${height}px;"><div id="${id}-map" style="width: 100%; height: 100%;"><div class="ovwHighlight" dojoattachpoint="_focusDiv" title="${NLS_drag}" style="border: 1px solid ${color}; background-color: ${color};"></div></div></div><div class="ovwButton ovwController" title="${NLS_show}" dojoattachpoint="_controllerDiv" dojoattachevent="onclick: _visibilityHandler"></div><div class="ovwButton ovwMaximizer" title="${NLS_maximize}" dojoattachpoint="_maximizerDiv" dojoattachevent="onclick: _maximizeHandler"></div></div>',
// Source: lib/esri/dijit/templates/BasemapGallery.html
'url:esri/dijit/templates/BasemapGallery.html': '<div class="esriBasemapGallery"><div dojoAttachPoint="flowContainer"></div></div>'
}});